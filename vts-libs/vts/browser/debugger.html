<!DOCTYPE html>
<html>
<head>
    <title>Surface debugger</title>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
</head>
<body style="width:100%;height:100%">
  <div id="debugger" style="width:100%;height:100%;position:absolute;left:0px;top:0px"></div>

    <script>
          function loadFreeLayer(callback) {
          var x = new XMLHttpRequest();
          x.overrideMimeType("application/json");
          x.open("GET", "freelayer.json", true);
          x.onreadystatechange = function () {
              if ((x.readyState) == 4 && ((x.status == 200) || (x.status == 0)))
              {
                  callback(JSON.parse(x.responseText));
              }
          };
          x.send(null);
      }

      var crs = L.CRS.Simple;

      var map = new L.Map("debugger", { crs: crs });

      loadFreeLayer(function (fl) {
          var startZoom = fl.lodRange[0];

          var url = fl.meshUrl.replace(/{lod}/g, "{z}")
              .replace(/bin/g, "mask.dbg");
          var maskLayer = new L.TileLayer(url, {
              minZoom: 0
              , maxZoom: fl.lodRange[1]
              , noWrap: true
          });

          var layers = {};
          var overlays = {};
          layers["mask"] = maskLayer;

          L.control.layers(layers, overlays).addTo(map);
          map.addLayer(maskLayer);

          // set view to center of tile range at min lod
          var center = [ (fl.tileRange[0][0] + fl.tileRange[1][0]) / 2.0 + 0.5
                         , (fl.tileRange[0][1] + fl.tileRange[1][1]) / 2.0 + 0.5];

          map.setView(crs.pointToLatLng(L.point(center[0] / Math.pow(2, startZoom - 8)
                                                , center[1] / Math.pow(2, startZoom - 8)))
                      , startZoom);
      });
    </script>

</body>
</html>
