<html>
<head>
<title>Vadstena Map Viewer</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<script type="text/javascript">var e,q={};window.Vadstena=q;glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;function s(a){var b=new glMatrixArrayType(2);a&&(b[0]=a[0],b[1]=a[1]);return b}function t(a){var b=new glMatrixArrayType(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b}function u(a){var b=new glMatrixArrayType(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b} function v(a){var b=new glMatrixArrayType(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b} function w(a,b){if(b&&a!=b)b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];else{var c=a[1],d=a[2],g=a[3],f=a[6],h=a[7],k=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=f;a[11]=a[14];a[12]=g;a[13]=h;a[14]=k}} function x(a,b,c){c||(c=a);var d=a[0],g=a[1],f=a[2],h=a[3],k=a[4],m=a[5],l=a[6],n=a[7],p=a[8],r=a[9],y=a[10],J=a[11],K=a[12],L=a[13],M=a[14];a=a[15];var N=b[0],O=b[1],P=b[2],Q=b[3],R=b[4],S=b[5],T=b[6],U=b[7],V=b[8],W=b[9],X=b[10],Y=b[11],Z=b[12],$=b[13],aa=b[14];b=b[15];c[0]=N*d+O*k+P*p+Q*K;c[1]=N*g+O*m+P*r+Q*L;c[2]=N*f+O*l+P*y+Q*M;c[3]=N*h+O*n+P*J+Q*a;c[4]=R*d+S*k+T*p+U*K;c[5]=R*g+S*m+T*r+U*L;c[6]=R*f+S*l+T*y+U*M;c[7]=R*h+S*n+T*J+U*a;c[8]=V*d+W*k+X*p+Y*K;c[9]=V*g+W*m+X*r+Y*L;c[10]=V*f+W*l+X*y+Y* M;c[11]=V*h+W*n+X*J+Y*a;c[12]=Z*d+$*k+aa*p+b*K;c[13]=Z*g+$*m+aa*r+b*L;c[14]=Z*f+$*l+aa*y+b*M;c[15]=Z*h+$*n+aa*J+b*a}function ba(a,b,c){c||(c=b);var d=b[0],g=b[1],f=b[2];b=b[3];c[0]=a[0]*d+a[4]*g+a[8]*f+a[12]*b;c[1]=a[1]*d+a[5]*g+a[9]*f+a[13]*b;c[2]=a[2]*d+a[6]*g+a[10]*f+a[14]*b;c[3]=a[3]*d+a[7]*g+a[11]*f+a[15]*b;return c} quat4={create:function(a){var b=new glMatrixArrayType(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},oc:function(a,b){var c=a[0],d=a[1],g=a[2];if(!b||a==b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-g*g)),a;b[0]=c;b[1]=d;b[2]=g;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-g*g));return b},inverse:function(a,b){if(!b||a==b)return a[0]*=1,a[1]*=1,a[2]*=1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b},length:function(a){var b= a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1],g=a[2],f=a[3],h=Math.sqrt(c*c+d*d+g*g+f*f);if(0==h)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;h=1/h;b[0]=c*h;b[1]=d*h;b[2]=g*h;b[3]=f*h;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],g=a[1],f=a[2];a=a[3];var h=b[0],k=b[1],m=b[2];b=b[3];c[0]=d*b+a*h+g*m-f*k;c[1]=g*b+a*k+f*h-d*m;c[2]=f*b+a*m+d*k-g*h;c[3]=a*b-d*h-g*k-f*m;return c},sc:function(a,b,c){c||(c=b);var d=b[0],g=b[1],f=b[2];b=a[0]; var h=a[1],k=a[2];a=a[3];var m=a*d+h*f-k*g,l=a*g+k*d-b*f,n=a*f+b*g-h*d,d=-b*d-h*g-k*f;c[0]=m*a+d*-b+l*-k-n*-h;c[1]=l*a+d*-h+n*-b-m*-k;c[2]=n*a+d*-k+m*-h-l*-b;return c},Ac:function(a,b){b||(b=new glMatrixArrayType(9));var c=a[0],d=a[1],g=a[2],f=a[3],h=c+c,k=d+d,m=g+g,l=c*h,n=c*k,c=c*m,p=d*k,d=d*m,g=g*m,h=f*h,k=f*k,f=f*m;b[0]=1-(p+g);b[1]=n-f;b[2]=c+k;b[3]=n+f;b[4]=1-(l+g);b[5]=d-h;b[6]=c-k;b[7]=d+h;b[8]=1-(l+p);return b},Bc:function(a,b){b||(b=v());var c=a[0],d=a[1],g=a[2],f=a[3],h=c+c,k=d+d,m=g+g, l=c*h,n=c*k,c=c*m,p=d*k,d=d*m,g=g*m,h=f*h,k=f*k,f=f*m;b[0]=1-(p+g);b[1]=n-f;b[2]=c+k;b[3]=0;b[4]=n+f;b[5]=1-(l+g);b[6]=d-h;b[7]=0;b[8]=c-k;b[9]=d+h;b[10]=1-(l+p);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},xc:function(a,b,c,d){d||(d=a);var g=c;0>a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]&&(g=-1*c);d[0]=1-c*a[0]+g*b[0];d[1]=1-c*a[1]+g*b[1];d[2]=1-c*a[2]+g*b[2];d[3]=1-c*a[3]+g*b[3];return d},yc:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}}; q.Ub=function(a,b,c,d,g,f){var h=b-a,k=d-c,m=f-g;a=v([2*g/h,0,(b+a)/h,0,0,2*g/k,(d+c)/k,0,0,0,-(f+g)/m,-2*f*g/m,0,0,-1,0]);w(a);return a};q.gc=function(a,b,c,d){a=c*Math.tan(a*Math.PI/360);b*=a;return q.Ub(-b,b,-a,a,c,d)};q.la=function(a,b){var c=Math.cos(b),d=Math.sin(b);switch(a){case 0:c=v([1,0,0,0,0,c,-d,0,0,d,c,0,0,0,0,1]);break;case 1:c=v([c,0,-d,0,0,1,0,0,d,0,c,0,0,0,0,1]);break;default:c=v([c,-d,0,0,d,c,0,0,0,0,1,0,0,0,0,1])}w(c);return c}; q.Fa=function(a,b,c){a=v([a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1]);w(a);return a};q.hc=function(a){return q.Fa(a,a,a)};q.ia=function(a,b,c){a=v([1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1]);w(a);return a};q.Cc=function(a){return q.ia(a[0],a[1],0)};q.Dc=function(a){return q.ia(a[0],a[1],a[2])};q.aa=function(a,b,c){a<b?a=b:a>c&&(a=c);return a};q.U=function(a){return a*Math.PI/180};q.Fb=function(a){a+="";return 7<=a.length?a:Array(7-a.length+1).join("0")+a}; q.ic=function(a,b){return a.replace(/\{([_$a-zA-Z0-9][_$a-zA-Z0-9]*)\}/g,function(a,d){return d in b?b[d]:a})};q.xb=function(a,b,c){var d=new XMLHttpRequest;d.onload=function(){var a=d.response;try{var f=eval("("+a+")")}catch(h){null!=c&&c();return}null!=b&&b(f)}.bind(this);d.onerror=function(){null!=c&&c()}.bind(this);d.open("GET",a,!0);d.send("")}; q.wb=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){switch(d.readyState){case 0:case 1:case 2:case 3:break;case 4:if(404==d.status){null!=c&&c();break}var a=new DataView(d.response);null!=b&&b(a);break;default:null!=c&&c()}}.bind(this);d.onerror=function(){null!=c&&c()}.bind(this);d.open("GET",a,!0);d.responseType="arraybuffer";d.send("")};window.performance=window.performance||{}; performance.now=performance.now||performance.qc||performance.rc||performance.tc||performance.webkitNow||function(){return(new Date).getTime()}; function ca(a,b){this.A=new z;this.Ab=this.Bb=this.mb=0;this.kb=u();this.jb=u();this.Rb=b;this.Kb=this.zb=this.Cb="";null!=a.foat&&(this.A.i=a.foat[0],this.A.l=a.foat[1],this.A.n=a.foat[2],this.mb=a.foat[3]);null!=a.meta&&(this.Bb=a.meta[0],this.Ab=a.meta[1]);this.Cb=a.metaTemplate;this.zb=a.meshTemplate;this.Kb=a.textureTemplate;if(null!=a.defaultPosition&&null!=a.defaultOrientation)for(var c=0;3>c;c++)this.kb[c]=a.defaultPosition[c],this.jb[c]=a.defaultOrientation[c]} function A(a,b){return a.mb>>b-a.A.i}function da(a){var b=q.r;return ea(b,b.Cb,a)}function fa(a){var b=q.r;return ea(b,b.zb,a)}function ga(a){var b=q.r;return ea(b,b.Kb,a)}function ea(a,b,c){b=q.ic(b,{lod:c.i,easting:q.Fb(c.l),northing:q.Fb(c.n)});return a.Rb+b}function ha(a){var b=q.r,c=A(b,12);return u([b.A.l+Math.round((a[0]-b.A.l)/c)*c,b.A.n+Math.round((a[1]-b.A.n)/c)*c,a[2]])} function ia(a){this.La=1073741824;this.pb=402653184;this.oa=4;this.hb=45;this.ib=20;this.fb=4E4;this.rb=8;this.sb=32;this.ba=[0.82,0.82,0.82];this.W="observer";if(null!=a&&(null!=a.cacheSize&&(this.La=a.cacheSize),null!=a.gpuCacheSize&&(this.pb=a.gpuCacheSize),null!=a.numThreads&&(this.oa=a.numThreads),null!=a.cameraFOV&&(this.hb=a.cameraFOV),null!=a.cameraNear&&(this.ib=a.cameraNear),null!=a.visibility&&(this.fb=a.visibility),null!=a.gridEmbeddingFactor&&(this.rb=a.gridEmbeddingFactor),null!=a.gridMinTileSize&& (this.sb=a.gridMinTileSize),null!=a.controlMode&&(this.W=a.controlMode),null!=a.controlInertia))for(var b=0;3>b;b++)this.ba[b]=a.controlInertia[b]}function ja(a,b,c,d,g,f){this.d=[];this.f=[];this.d[0]=null!=a?a:Number.POSITIVE_INFINITY;this.d[1]=null!=b?b:Number.POSITIVE_INFINITY;this.d[2]=null!=c?c:Number.POSITIVE_INFINITY;this.f[0]=null!=d?d:Number.NEGATIVE_INFINITY;this.f[1]=null!=g?g:Number.NEGATIVE_INFINITY;this.f[2]=null!=f?f:Number.NEGATIVE_INFINITY}function B(a,b){return a.f[b]-a.d[b]} function ka(a,b){return new ja(a.d[0]-b[0],a.d[1]-b[1],a.d[2],a.f[0]-b[0],a.f[1]-b[1],a.f[2])}function la(a){this.ea=[];this.xa=null!=a?a:Number.MAX_VALUE;this.ha=0}e=la.prototype;e.log=function(){for(var a=0,b=this.M;null!=b.Y&&!(b=this.ea[b.Y][3],a++,10<a););this.ea.forEach(function(){})};e.find=function(a){a=this.hash(a);a=this.ea[a];if(null!=a){if(this.M!=a){null!=a.T&&(a.T.Y=a.Y);null!=a.Y&&(a.Y.T=a.T);this.X==a&&(this.X=a.T);var b=this.M;this.M=a;this.M.Y=b;this.M.T=null;b.T=this.M}return a.vb}return null}; e.contains=function(a){return null!=this.ea[this.hash(a)]};e.clear=function(){this.ea=[]};function ma(a,b,c,d){b=a.hash(b);c={Xb:b,vb:c,Tb:d,T:null,Y:a.M};null!=a.M&&(a.M.T=c);a.M=c;null==a.X&&(a.X=c);a.ea[b]=c;a.ha+=d;na(a)}function na(a){for(;a.ha>a.xa;){var b=a.X;if(null!=b)a.X=a.X.T,null!=a.X&&(a.X.Y=null),delete a.ea[b.Xb],a.ha-=b.Tb,b.vb.N();else break}}e.hash=function(a){return""+Math.round(a.i)+"."+Math.round(a.l)+"."+Math.round(a.n)}; function oa(a,b,c,d){null==c&&(c=1);this.oa=c;this.Ka=0;this.u=new la(a);this.fa=[];this.za=[];this.da=[];this.Db=b;this.lb=d}e=oa.prototype;e.N=function(){};e.get=function(a){var b=this.u.find(a);null==b&&this.Wa(a);return b};e.contains=function(a){return this.u.contains(a)};e.trim=function(a){var b=this.u.xa,c=this.u;c.xa=a;na(c);a=this.u;a.xa=b;na(a)};e.reset=function(){this.u.clear()};e.size=function(){return this.u.ha}; e.Wa=function(a){var b=this.u.hash(a),c=this.da.indexOf(b);-1==c&&(c=this.fa.indexOf(b),-1!=c&&(this.fa.splice(c,1),this.za.splice(c,1)),this.fa.unshift(b),this.za.unshift(a),20<this.fa.length&&(this.fa.pop(),this.za.pop()))}; e.update=function(){if(0<this.fa.length&&this.Ka<this.oa){var a=this.fa.shift(),b=this.za.shift();if(-1==this.da.indexOf(a)){this.da.push(a);this.Ka++;var a=function(a,b){this.da.splice(this.da.indexOf(this.u.hash(a)),1);this.Ka--;ma(this.u,a,b,b.size());null!=this.Db&&this.Db(a)}.bind(this),c=function(a){this.da.splice(this.da.indexOf(this.u.hash(a)),1);this.Ka--}.bind(this);null!=this.lb&&new this.lb(b,a,c)}}}; function pa(a,b,c){this.a=u([0,0,0]);this.e=u([0,0,0]);this.gb=1;this.nb=a;this.Va=b;this.Na=c;this.S=v();this.Ba=v();this.ya=v();this.Q=[t(),t(),t(),t(),t(),t()];this.p=!0}e=pa.prototype;e.Ha=function(a){this.a=a;this.p=!0};e.Ga=function(a){this.e=a;this.p=!0};e.ka=function(){return u(this.a)};e.ob=function(){return u(this.e)};function qa(a){a.p&&a.update();return a.S}function ra(a){a.p&&a.update();return a.Ba} function sa(a,b){a.p&&a.update();for(var c=[[b.d[0],b.d[1],b.d[2],1],[b.d[0],b.d[1],b.f[2],1],[b.d[0],b.f[1],b.d[2],1],[b.d[0],b.f[1],b.f[2],1],[b.f[0],b.d[1],b.d[2],1],[b.f[0],b.d[1],b.f[2],1],[b.f[0],b.f[1],b.d[2],1],[b.f[0],b.f[1],b.f[2],1]],d=0;6>d;d++){for(var g=!0,f=0;8>f;f++){var h=a.Q[d],k=c[f];if(0<h[0]*k[0]+h[1]*k[1]+h[2]*k[2]+h[3]*k[3]){g=!1;break}}if(g)return!1}return!0} e.update=function(){this.S=v();x(q.la(1,q.U(-this.e[2])),q.la(0,q.U(-this.e[1]-90)),this.S);x(this.S,q.la(2,q.U(-this.e[0])),this.S);x(this.S,q.ia(-this.a[0],-this.a[1],-this.a[2]),this.S);this.Ba=q.gc(this.nb,this.gb,this.Va,this.Na);this.ya=v();x(this.Ba,this.S,this.ya);this.Q[0]=t([0,0,1,1]);this.Q[1]=t([0,0,-1,1]);this.Q[2]=t([1,0,0,1]);this.Q[3]=t([-1,0,0,1]);this.Q[4]=t([0,1,0,1]);this.Q[5]=t([0,-1,0,1]);var a=v();w(this.ya,a);for(var b=0;6>b;b++)this.Q[b]=ba(a,this.Q[b]);this.p=!1}; q.Jb=function(a,b,c,d,g){var f=d.get(b);if(!f)return[c,b.i>=g];var h=A(q.r,b.i);c=(a[0]-b.l)/h;h=(a[1]-b.n)/h;c=q.aa(c,0,0.9999);var h=q.aa(h,0,0.9999),k=c*(q.B-1),m=h*(q.B-1),l=Math.floor(k),n=Math.floor(m),p=f.G[n*q.B+l],r=f.G[(n+1)*q.B+l],k=k-l,p=p+(f.G[n*q.B+l+1]-p)*k,m=p+(r+(f.G[(n+1)*q.B+l+1]-r)*k-p)*(m-n),l=0,l=0.5>h?0.5>c?0:1:0.5>c?2:3;return!(f.L&1<<l)||b.i>=g?[m,!0]:q.Jb(a,C(b,l),m,d)};q.ua=function(a,b){var c;null==c&&(c=Number.MAX_VALUE);return q.Jb(a,q.r.A,0,b,c)}; function ta(a,b){this.c=null;this.wa=a;this.s=null;this.C=b}e=ta.prototype; e.Ra=function(){this.s=document.createElement("canvas");if(null!=this.s&&(this.s.width=this.C[0],this.s.height=this.C[1],this.s.style.display="block",null!=this.s.getContext)){try{this.c=this.s.getContext("webgl")||this.s.getContext("experimental-webgl")}catch(a){}this.c&&(q.c=this.c,this.wa.appendChild(this.s),this.c.eb=this.s.width,this.c.cb=this.s.height,this.c.clearColor(0,0,0,1),this.c.enable(this.c.DEPTH_TEST),this.c.viewport(0,0,this.c.eb,this.c.cb),this.c.clear(this.c.COLOR_BUFFER_BIT|this.c.DEPTH_BUFFER_BIT))}}; e.resize=function(a){this.C=a;null!=this.s&&(this.s.width=this.C[0],this.s.height=this.C[1]);null!=this.c&&(this.c.eb=this.s.width,this.c.cb=this.s.height)};e.clear=function(){this.c.viewport(0,0,this.c.eb,this.c.cb);this.c.clear(this.c.COLOR_BUFFER_BIT|this.c.DEPTH_BUFFER_BIT);this.c.enable(this.c.CULL_FACE)};e.useProgram=function(a){this.c.useProgram(a.O)};e.bindTexture=function(a){!1!=a.Ua&&(this.c.activeTexture(this.c.TEXTURE0),this.c.bindTexture(this.c.TEXTURE_2D,a.K))};q.nc=function(){return!0}; function D(a){this.g=a.g;var b=q.c;null!=b&&(this.ja=this.V=null,this.V=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.V),b.bufferData(b.ARRAY_BUFFER,new Float32Array(a.k),b.STATIC_DRAW),this.V.Sa=3,this.V.Xa=a.k.length/3,this.ja=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.ja),b.bufferData(b.ARRAY_BUFFER,new Float32Array(a.o),b.STATIC_DRAW),this.ja.Sa=2,this.ja.Xa=a.o.length/2,this.J=4*(a.k.length+a.o.length)+32,this.Ya=this.V.Xa/3)} D.prototype.N=function(){var a=q.c;a.deleteBuffer(this.V);a.deleteBuffer(this.ja)};function ua(a,b){var c=q.c;if(null!=c){var d=c.getAttribLocation(b.O,"aPosition"),g=c.getAttribLocation(b.O,"aTexCoord");c.enableVertexAttribArray(d);c.enableVertexAttribArray(g);c.bindBuffer(c.ARRAY_BUFFER,a.V);c.vertexAttribPointer(d,a.V.Sa,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,a.ja);c.vertexAttribPointer(g,a.ja.Sa,c.FLOAT,!1,0,0);c.drawArrays(c.TRIANGLES,0,a.V.Xa)}}D.prototype.size=function(){return this.J}; function E(a,b){this.O=null;this.bb=[];this.createProgram(a,b)}E.prototype.createShader=function(a,b){if(!a)return null;var c=q.c;if(null!=c){var d;d=!0!=b?c.createShader(c.FRAGMENT_SHADER):c.createShader(c.VERTEX_SHADER);c.shaderSource(d,a);c.compileShader(d);return c.getShaderParameter(d,c.COMPILE_STATUS)?d:(alert("An error occurred compiling the shaders: "+c.getShaderInfoLog(d)),null)}}; E.prototype.createProgram=function(a,b){var c=q.c;if(null!=c){var d=this.createShader(a,!0),g=this.createShader(b,!1),f=c.createProgram();c.attachShader(f,d);c.attachShader(f,g);c.linkProgram(f);c.getProgramParameter(f,c.LINK_STATUS)||alert("Unable to initialize the shader program.");c.useProgram(f);this.O=f}};function va(a){var b=q.c;null!=b&&null!=a.O&&(a=a.getUniform("uSampler"),null!=a&&b.uniform1i(a,0))} function F(a,b,c){var d=q.c;null!=d&&null!=a.O&&(a=a.getUniform(b),null!=a&&d.uniformMatrix4fv(a,!1,c))}function wa(a,b,c){var d=q.c;null!=d&&null!=a.O&&(a=a.getUniform(b),null!=a&&d.uniform1f(a,c))}E.prototype.getUniform=function(a){var b=q.c;if(null!=b&&null!=this.O)return null==this.bb[a]?(b=b.getUniformLocation(this.O,a),this.bb[a]=b):this.bb[a]};q.kc="#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMVP;\nvarying vec2 vTexCoord;\nvoid main(){ \ngl_Position = uMVP * vec4(aPosition, 1.0);\nvTexCoord = aTexCoord;\n}"; q.jc="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nconst vec4 gray = vec4(0.125, 0.125, 0.125, 1.0);\nvoid main() {\nfloat fade = smoothstep(0.49, 0.52, vTexCoord.t);\ngl_FragColor = mix(texture2D(uSampler, vTexCoord), gray, fade);\n}";q.$b="#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nuniform mat4 uGridMat;\nuniform float uGridStep1, uGridStep2;\nconst int HMSize = 5;\nconst float HMSize1 = float(HMSize-1);\nuniform float uHeight[HMSize*HMSize];\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nfloat round(float x) { return floor(x + 0.5); }\nvoid main() {\nvec3 pos = aPosition;\nfloat z = uHeight[int(round(pos.y*HMSize1)*float(HMSize) + round(pos.x*HMSize1))];\nvec4 camSpacePos = uMV * vec4(pos.xy, z, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvec4 gridCoord = uGridMat * vec4(pos, 1.0);\nvTexCoord1 = aTexCoord;\nvTexCoord1 = gridCoord.xy * vec2(uGridStep1);\nvTexCoord2 = gridCoord.xy * vec2(uGridStep2);\n}"; q.Yb="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D uSampler;\nuniform float uGridBlend;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nconst vec4 fogColor = vec4(1, 1, 1, 1);\nvoid main() {\nvec4 gridColor = mix(texture2D(uSampler, vTexCoord1), texture2D(uSampler, vTexCoord2), uGridBlend);\ngl_FragColor = mix(fogColor, gridColor, vFogFactor);\n}";q.mc="#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvTexCoord = aTexCoord;\n}"; q.lc="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nconst vec4 fogColor = vec4(1, 1, 1, 1);\nvoid main() {\ngl_FragColor = mix(fogColor, texture2D(uSampler, vTexCoord), vFogFactor);\n}";function G(a){this.K=null;this.J=0;this.w=null;this.Ua=!1;null!=a&&this.load(a)}G.prototype.N=function(){q.c.deleteTexture(this.K)};G.prototype.size=function(){return this.J}; function xa(a,b,c){var d=q.c;a.K=d.createTexture();d.bindTexture(d.TEXTURE_2D,a.K);c=!0==c?d.REPEAT:d.CLAMP_TO_EDGE;d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,c);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,c);c=!1;switch("linear"){case "linear":d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);break;case "trilinear":d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER, d.LINEAR);c=!0;break;default:d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST)}d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b);!0==c&&d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null);a.J=b.naturalWidth*b.naturalHeight*4;a.Ua=!0} G.prototype.load=function(a,b,c){this.w=new Image;this.w.crossOrigin="anonymous";this.w.onload=function(){xa(this,this.w,!1);this.w=null}.bind(this);this.w.onerror=function(){null!=c&&c()}.bind(this);this.w.src=a};function ya(a){this.H=new D(a.H);this.K=new G;xa(this.K,a.w)}ya.prototype.N=function(){this.H.N();this.K.N()};ya.prototype.size=function(){return this.H.size()+this.K.size()};function za(a){this.u=new la(a)} za.prototype.get=function(a,b){var c=this.u.find(a);if(c)return c;c=new ya(b);ma(this.u,a,c,c.size());return c};za.prototype.size=function(){return this.u.ha};function H(){this.k=[];this.o=[];this.g=new ja} H.prototype.load=function(a,b,c){q.wb(a,function(a){for(var c=0,f=1/65535,h="",k=0;8>k;k++)h+=String.fromCharCode(a.getUint8(c,!0)),c+=1;if("BIN.MESH"==h&&(k=a.getUint32(c,!0),c+=4,!(1<k))){for(k=0;3>k;k++)this.g.d[k]=a.getFloat64(c,!0),c+=8;for(k=0;3>k;k++)this.g.f[k]=a.getFloat64(c,!0),c+=8;for(var h=a.getUint16(c,!0),c=c+2,m=[],l=0;l<h;l++)for(m[l]=[],k=0;3>k;k++)m[l][k]=a.getUint16(c,!0),c+=2;for(var h=a.getUint16(c,!0),c=c+2,n=[],l=0;l<h;l++){n[l]=[];for(k=0;2>k;k++)n[l][k]=a.getUint16(c,!0), c+=2;n[l][1]=65535-n[l][1]}h=a.getUint16(c,!0);c+=2;this.k=[];for(l=0;l<h;l++)this.k[l]={uc:[],zc:[]};for(l=0;l<h;l++){for(k=0;3>k;k++){var p=a.getUint16(c,!0),c=c+2,r=9*l+3*k;this.k[r]=m[p][0]*f;this.k[r+1]=m[p][1]*f;this.k[r+2]=m[p][2]*f}for(k=0;3>k;k++)p=a.getUint16(c,!0),c+=2,r=6*l+2*k,this.o[r]=n[p][0]*f,this.o[r+1]=n[p][1]*f}this.J=8*(this.k.length+this.o.length)+56;null!=b&&b()}}.bind(this),function(){null!=c&&c()}.bind(this))};H.prototype.size=function(){return this.J}; q.Ia=function(a,b){b*=Math.PI;a=2*a*Math.PI;return u([Math.cos(a)*Math.sin(b)*0.5+0.5,Math.sin(a)*Math.sin(b)*0.5+0.5,0.5*Math.cos(b)+0.5])};q.B=5; function Aa(a,b){this.g=new ja;this.Aa=[];this.G=[];this.L=0;this.sa=[];for(var c=0;2>c;c++)this.Aa[c]=[];var d=b.ca.getUint16(b.m,!0);b.m+=2;c=b.ca.getUint16(b.m,!0);b.m+=2;this.g.d[0]=a.l;this.g.d[1]=a.n;this.g.d[2]=d;d=A(q.r,a.i);this.g.f[0]=a.l+d;this.g.f[1]=a.n+d;this.g.f[2]=c;for(c=0;2>c;c++)for(d=0;2>d;d++)this.Aa[c][d]=b.ca.getFloat32(b.m,!0),b.m+=4;c=0;for(d=q.B*q.B;c<d;c++)this.G[c]=b.ca.getInt16(b.m,!0),b.m+=2;for(c=0;4>c;c++)this.sa[c]=null;this.L=0} Aa.prototype.ma=function(a){var b=v();x(q.ia(this.g.d[0]-a[0],this.g.d[1]-a[1],0),q.Fa(B(this.g,0),B(this.g,1),1),b);return b};Aa.prototype.size=function(){for(var a=304,b=0;4>b;b++)null!=this.sa[b]&&(a+=this.sa[b].size());return a};function Ba(a,b){this.q=a;for(var c="",d=0;8>d;d++)c+=String.fromCharCode(b.ca.getUint8(b.m,!0)),b.m+=1;"METATILE"==c&&(c=b.ca.getUint32(b.m,!0),b.m+=4,1<c||(this.Mb=Ca(this,a,b)))}Ba.prototype.N=function(){}; function Ca(a,b,c){var d=new Aa(b,c),g=c.ca.getUint8(c.m,!0);c.m+=1;for(var f=0;4>f;f++)g&1<<f+4&&(d.sa[f]=Ca(a,C(b,f),c));d.L=g&15;return d}Ba.prototype.size=function(){return this.Mb.size()};q.Ob=function(a,b,c){this.q=a;this.qa=b;this.pa=c;this.bc=function(a){null!=this.qa&&(a=new Ba(this.q,{ca:a,m:0}),this.qa(this.q,a))}.bind(this);this.ac=function(){null!=this.pa&&this.pa(this.q)}.bind(this);q.wb(da(this.q),this.bc,this.ac)}; function Da(a,b,c,d){this.v=new oa(a,b,c,d);this.N=this.v.N.bind(this.v);this.contains=this.v.contains.bind(this.v);this.trim=this.v.trim.bind(this.v);this.reset=this.v.reset.bind(this.v);this.Wa=this.v.Wa.bind(this.v);this.update=this.v.update.bind(this.v);this.size=this.v.size.bind(this.v)} Da.prototype.get=function(a){for(var b=a,c=q.r;Math.abs(b.i-c.Bb)%c.Ab&&b.i>c.A.i;)b=b.parent();if(c=this.v.get(b)){b=new z(c.q.i,c.q.l,c.q.n);for(c=c.Mb;b.i<a.i;){var d=A(q.r,b.i),g=b.l+d/2,d=b.n+d/2,f=0;Math.round(a.l)>=Math.round(g)&&(f|=1,b.l=g);Math.round(a.n)>=Math.round(d)&&(f|=2,b.n=d);b.i++;(c=c.sa[f])||console.log("Missing tile metadata")}!b.isEqual(a)&&console.log("Metatile inconsistency");a=c}else a=null;return a};q.Za=1.1; function Ea(a,b){this.ra=this.F=this.ga=null;this.wa=a;this.Eb=b;this.C=[a.clientWidth,a.clientHeight];this.Lb=!1;this.p=this.tb=!0;this.R=new ta(a,this.C);this.h=new pa(q.j.hb,q.j.ib,q.j.fb);this.a=u(q.r.kb);this.e=u(q.r.jb);this.I=new Da(Number.MAX_VALUE,function(){this.p=!0}.bind(this),q.j.oa,q.Ob);this.$=new q.Pb(Number.MAX_VALUE,function(){this.p=!0}.bind(this),q.j.oa,q.Qb);this.qb=new za(q.j.pb);this.Hb=this.ab=this.Qa=this.Pa=null;this.Nb=this.Zb=!1;this.Ib=document.getElementById("renderStats"); this.Ca=this.Gb=this.Z=this.Da=this.Ea=this.Ja=this.ta=0;this.Ta=null;this.Oa=0;window.addEventListener("resize",function(){Fa(this,this.wa.clientWidth,this.wa.clientHeight)}.bind(this));this.R.Ra();this.ga=new E(q.mc,q.lc);this.F=new E(q.$b,q.Yb);this.ra=new E(q.kc,q.jc);Ga(this);Ha(this);Fa(this,this.C[0],this.C[1]);window.requestAnimationFrame(this.update.bind(this))} function Ga(a){var b=new H,c=q.B;c--;for(var d=0;d<c;d++)for(var g=0;g<c;g++){var f=g/c,h=(g+1)/c,k=d/c,m=(d+1)/c;b.k.push(f,k,0);b.k.push(h,k,0);b.k.push(h,m,0);b.o.push(f,k);b.o.push(h,k);b.o.push(h,m);b.k.push(h,m,0);b.k.push(f,m,0);b.k.push(f,k,0);b.o.push(h,m);b.o.push(f,m);b.o.push(f,k)}b.g.d[0]=b.g.d[1]=b.g.d[2]=0;b.g.f[0]=b.g.f[1]=b.g.f[2]=1;b.J=8*(b.k.length+b.o.length)+56;a.Pa=new D(b);b=new Uint8Array(16384);for(c=0;64>c;c++)for(d=0;64>d;d++)g=4*(64*c+d),1>c||63<=c||1>d||63<=d?(b[g]=255, b[g+1]=255,b[g+2]=255):(b[g]=32,b[g+1]=32,b[g+2]=32),b[g+3]=255;a.Qa=new G;a=a.Qa;d=!0;c=q.c;a.K=c.createTexture();c.bindTexture(c.TEXTURE_2D,a.K);d=!0==d?c.REPEAT:c.CLAMP_TO_EDGE;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,d);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,d);d=!1;switch("trilinear"){case "linear":c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);break;case "trilinear":c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER, c.LINEAR_MIPMAP_LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);d=!0;break;default:c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST)}c.pixelStorei(c.UNPACK_ALIGNMENT,1);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,64,64,0,c.RGBA,c.UNSIGNED_BYTE,b);!0==d&&c.generateMipmap(c.TEXTURE_2D);c.bindTexture(c.TEXTURE_2D,null);a.J=16384;a.Ua=!0} function Ha(a){for(var b=new H,c=0;32>c;c++)for(var d=0;64>d;d++){var g=b,f=d/64,h=c/32,k=(d+1)/64,m=(c+1)/32,l=u(q.Ia(f,h)),n=s([f,h]),p=u(q.Ia(f,m)),f=s([f,m]),r=u(q.Ia(k,h)),h=s([k,h]),y=u(q.Ia(k,m)),k=s([k,m]);g.k.push(p[0],p[1],p[2]);g.k.push(l[0],l[1],l[2]);g.k.push(r[0],r[1],r[2]);g.o.push(f[0],f[1]);g.o.push(n[0],n[1]);g.o.push(h[0],h[1]);g.k.push(r[0],r[1],r[2]);g.k.push(y[0],y[1],y[2]);g.k.push(p[0],p[1],p[2]);g.o.push(h[0],h[1]);g.o.push(k[0],k[1]);g.o.push(f[0],f[1]);g.J=8*(g.k.length+ g.o.length)+56}b.g.d[0]=b.g.d[1]=b.g.d[2]=0;b.g.f[0]=b.g.f[1]=b.g.f[2]=1;a.ab=new D(b);a.Hb=new G("./skydome.jpg")}function Fa(a,b,c){var d=a.h;d.gb=b/c;d.p=!0;a.C=[b,c];a.R.resize(a.C);Ia(a)}function Ja(a){var b=Math.log(0.05)/q.j.fb;wa(a,"uFogDensity",b)} function Ka(a,b,c,d){if(c&&!a.Zb)d=a.qb.get(b,c),a.R.useProgram(a.ga),b=v(),x(qa(a.h),c.ma(a.a),b),c=ra(a.h),F(a.ga,"uMV",b),F(a.ga,"uProj",c),Ja(a.ga),a.R.bindTexture(d.K),va(a.ga),ua(d.H,a.ga),a.Ea++,a.Z+=d.H.Ya;else{a.R.useProgram(a.F);b=v();x(qa(a.h),d.ma(a.a),b);F(a.F,"uMV",b);F(a.F,"uProj",ra(a.h));c=v(d.ma(ha(a.a)));F(a.F,"uGridMat",c);Ja(a.F);c=q.j.rb;b=q.j.sb;var g=a.h.ka()[2],f=q.B,g=Math.log(g-0.25*(d.G[0]+d.G[f-1]+d.G[(f-1)*f]+d.G[(f-1)*f+f-1])+20)/Math.log(c),f=Math.pow(c,Math.ceil(g)), h=g-Math.floor(g);wa(a.F,"uGridStep1",b/Math.pow(c,Math.floor(g)));wa(a.F,"uGridStep2",b/f);wa(a.F,"uGridBlend",h);c=a.F;d=d.G;b=q.c;null!=b&&null!=c.O&&(c=c.getUniform("uHeight"),null!=c&&b.uniform1fv(c,d));a.R.bindTexture(a.Qa);va(a.F);ua(a.Pa,a.F);a.Da++;a.Z+=a.Pa.Ya}} function La(a,b){for(var c=v(b.ma(a.a)),d=a.C[0]/2,g=0,f=q.B,h=q.B-1,k=0;1>=k;k++)for(var m=0;1>=m;m++){var l=[];ba(c,[m,k,b.G[k*h*f+m*h],1],l);var n=a.h;n.p&&n.update();var p=t();ba(n.S,l,p);var l=p,p=l[0],r=l[1],l=l[2],l=Math.sqrt(p*p+r*r+l*l),n=(l<n.Va?Number.POSITIVE_INFINITY:n.Ba[0]/l)*b.Aa[k][m]*d;n>g&&(g=n)}return g} function Ma(a,b){var c=a.I.get(b);if(!c||!sa(a.h,ka(c.g,a.a)))return 0;var d=La(a,c);if(!c.L||d<q.Za){var g=a.$.get(b),f;if(!(f=g)){a:if(c.L){for(f=0;4>f;f++)if(c.L&1<<f&&!a.$.contains(C(b,f))){f=!1;break a}f=!0}else f=!1;f=!f}f?Ka(a,b,g,c):Na(a,b,c);return d}if(d=2.2>d)a:{if(a.$.contains(b)&&1E4>c.Aa[0][0])for(d=0;4>d;d++)if(c.L&1<<d&&(g=C(b,d),!a.$.get(g))){a.I.get(g);d=!0;break a}d=!1}return d?(g=a.$.get(b),Ka(a,b,g,c),0):Na(a,b,c)} function Na(a,b,c){var d=[[3,1,2,0],[3,2,1,0],[2,3,0,1],[2,0,3,1],[0,2,1,3],[0,1,2,3],[1,0,3,2],[1,3,0,2]],g;g=c.g;g=u([0.5*(g.d[0]+g.f[0]),0.5*(g.d[1]+g.f[1]),0.5*(g.d[2]+g.f[2])]);var f=a.h.a;g=u([a.a[0]+f[0]-g[0],a.a[1]+f[1]-g[1],a.a[2]+f[2]-g[2]]);g=Math.floor((Math.atan2(g[1],g[0])+Math.PI)/Math.PI*4);g=q.aa(g,0,7);for(var h=f=0;4>h;h++){var k=d[g][h];c.L&1<<k&&(f=Math.max(f,Ma(a,C(b,k))))}return f} function Oa(a,b){var c=a.I.get(b);if(!c||!sa(a.h,ka(c.g,a.a)))return 0;var d=La(a,c);if(!c.L||d<q.Za)return d;for(var g=d=0;4>g;g++)c.L&1<<g&&(d=Math.max(d,Oa(a,C(b,g))));return d} function I(a){switch(q.j.W){case "observer":a.e[1]=q.aa(a.e[1],-90,10);a.a[2]=q.aa(a.a[2],5,8E3);var b=v();x(q.la(2,q.U(a.e[0])),q.la(0,q.U(a.e[1])),b);x(b,q.la(1,q.U(a.e[2])),b);var c=u([0,-a.a[2],0]),d=c,g;g||(g=d);var f=d[0],h=d[1],d=d[2];g[0]=b[0]*f+b[4]*h+b[8]*d+b[12];g[1]=b[1]*f+b[5]*h+b[9]*d+b[13];g[2]=b[2]*f+b[6]*h+b[10]*d+b[14];c[2]+=q.ua(a.a,a.I)[0];a.h.Ha(c);a.h.Ga(a.e);break;case "drone":a.e[1]=q.aa(a.e[1],-90,90);a.a[2]=q.aa(a.a[2],5,8E3);b=a.h.a;a.h.Ha(u([0,0,a.a[2]+q.ua([a.a[0]+b[0], a.a[1]+b[1]],a.I)[0]]));a.h.Ga(a.e);break;case "manual":a.h.Ha(u([0,0,a.a[2]])),a.h.Ga(a.e)}a.p=!0}function Pa(a){var b=a.h.a;return a.h.ka()[2]-q.ua([a.a[0]+b[0],a.a[1]+b[1]],a.I)[0]} function Qa(a,b){var c=!1;if("manual"==q.j.W)return!1;for(;b>q.Za||0>Pa(a);){c=!0;if("observer"==q.j.W)if(a.Lb||-10<a.e[1])250>a.a[2]?a.a[2]+=0.3:a.e[1]-=0.3;else{var d=q.U(a.e[0]),g=q.U(-a.e[1]),f=0.5/Math.sin(g),g=f*Math.cos(g),d=[-Math.sin(d),Math.cos(d),0];a.a[0]+=g*d[0];a.a[1]+=g*d[1];a.a[2]+=f}else a.a[2]+=0.5;I(a);b=Oa(a,q.r.A)}return c} function Ia(a){if("drone"==q.j.W&&!a.tb){var b=q.ua(a.a,a.I);if(!b[1])return;a.a[2]+=b[0];a.tb=!0}b=0;do{a.R.clear();I(a);var b=Ma(a,q.r.A),c=a,d=v();x(q.Fa(2,2,2),q.ia(-0.5,-0.5,-0.5),d);var g=v();x(q.ia(c.h.ka()[0],c.h.ka()[1],c.h.ka()[2]-400),q.hc(0.9*c.h.Na),g);var f=v(),h=c.h;h.p&&h.update();x(h.ya,g,f);x(f,d,f);c.R.useProgram(c.ra);c.R.bindTexture(c.Hb);va(c.ra);F(c.ra,"uMVP",f);ua(c.ab,c.ra);c.Z+=c.ab.Ya}while(Qa(a,b));a.I.trim(q.j.La/10);a.$.trim(q.j.La);a.Lb=!1} Ea.prototype.update=function(){if(null!=q.b){null!=this.Eb&&this.Eb();this.I.update();this.$.update();if(!0==this.Nb&&(this.Z=this.Da=this.Ea=0,this.ta++,10<=this.ta)){var a=Date.now();null!=this.Ta&&(this.Oa=0.5*(1E3/(a-this.Ta)*this.ta+this.Oa));this.Ta=a}a=performance.now();!0==this.p&&Ia(this);!0==this.Nb&&(this.Ja++,this.Ca+=performance.now()-a,100<=this.Ja&&(this.Gb=this.Ca/this.Ja,this.Ja=this.Ca=0),null!=this.Ib&&10<=this.ta&&(this.ta=0,!0==this.p&&(this.Ib.innerHTML="Redered tiles: "+(this.Ea+ this.Da)+"<br/>Terrain tiles: "+this.Ea+"<br/>Heightmap tiles: "+this.Da+"<br/>Tile cache: "+Math.round(this.$.size()/1048576)+"MB<br/>Metatile cache: "+Math.round(this.I.size()/1048576)+"MB<br/>GPU cache: "+Math.round(this.qb.size()/1048576)+"MB<br/>Polygons: "+this.Z+"<br/>Render time: "+Math.round(1E3*this.Gb)+"<br/>FPS: "+Math.round(this.Oa))));this.p=!1;window.requestAnimationFrame(this.update.bind(this))}}; function Ra(a,b,c){this.q=a;this.H=b;this.w=c;this.J=this.H.size()+c.naturalWidth*c.naturalHeight*3}Ra.prototype.N=function(){};Ra.prototype.ma=function(a){var b=A(q.r,this.q.i),c=b/2+this.q.l-a[0];a=b/2+this.q.n-a[1];var b=this.H.g,d=v();x(q.ia(b.d[0]+c,b.d[1]+a,b.d[2]),q.Fa(B(b,0),B(b,1),B(b,2)),d);return d};Ra.prototype.size=function(){return this.J};q.Pb=oa; q.Qb=function(a,b,c){this.q=a;this.qa=b;this.pa=c;this.Ma=this.ub=this.yb=!1;this.va=function(){!0==this.Ma?null!=this.pa&&this.pa():!0==this.yb&&!0==this.ub&&null!=this.qa&&this.qa(this.q,new Ra(this.q,this.H,this.w))}.bind(this);this.w=new Image;this.w.onload=function(){this.ub=!0;this.va()}.bind(this);this.w.onerror=function(){this.Ma=!0;this.va()}.bind(this);this.w.crossOrigin="anonymous";this.w.src=ga(this.q);this.H=new H;this.dc=function(){this.yb=!0;this.va()}.bind(this);this.cc=function(){this.Ma= !0;this.va()}.bind(this);this.H.load(fa(this.q),this.dc,this.cc)};function z(a,b,c){this.i=null!=a?a:0;this.l=null!=b?b:0;this.n=null!=c?c:0}function C(a,b){var c=A(q.r,a.i),d=a.l+c/2,c=a.n+c/2;switch(b){case 0:return new z(a.i+1,a.l,a.n);case 1:return new z(a.i+1,d,a.n);case 2:return new z(a.i+1,a.l,c);case 3:return new z(a.i+1,d,c)}}z.prototype.parent=function(){var a=A(q.r,this.i),b=q.r.A;return new z(this.i-1,b.l+((this.l-b.l)/a&-2)*a,b.n+((this.n-b.n)/a&-2)*a)}; z.prototype.isEqual=function(a){return this.i==a.i&&this.l==a.l&&this.n==a.n};q.na={D:[],t:[],P:[]}; q.Ra=function(a,b,c,d){if(null!=b&&""!=b){var g=b.split("?")[0].split("/").slice(0,-1).join("/")+"/",f=document.getElementById(a);if(null==f)null!=d&&d(!1,"div does not exist");else{var h=null,k=null,m=function(){null==h||null==k&&null!=c||(q.r=new ca(h,g),q.j=new ia(k),q.b=new Ea(f,q.ec),null!=d&&d(!0))}.bind(this);a=function(a){h=a;m()}.bind(this);var l=function(a){k=a;m()}.bind(this),n=function(a){null!=d&&d(!1,a+" config not found")}.bind(this);null!=c&&q.xb(c,l,n.bind(this,"browser"));q.xb(b, a,n.bind(this,"map"))}}};q.Sb=function(){var a=document.createElement("canvas");if(null==a)return!1;a.width=1024;a.height=768;if(null==a.getContext)return!1;var b=null;try{b=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(c){return!1}return b?!0:!1};q.$a=function(a){if(null!=q.b&&null!=q.b.h&&q.j.W!=a){if("manual"==a){var b=q.Wb();b[0]>q.b.a[2]&&(q.b.a[2]=b[0]+100)}q.j.W=a;I(q.b);a=q.na;a.D=[];a.P=[];a.t=[]}};q.Vb=function(){return q.j.W}; q.Ha=function(a,b,c){null!=q.b&&(q.b.a=u([a,b,c]),I(q.b))};q.ka=function(){return u([q.b.a[0],q.b.a[1],q.b.a[2]])};q.Ga=function(a,b,c){null!=q.b&&(q.b.e=u([a,b,c]),I(q.b))};q.ob=function(){return q.b.e};q.wc=function(a,b,c){if(null!=q.b&&null!=q.b.h){var d=q.b.h;d.nb=a;d.Va=b;d.Na=c;d.p=!0;I(q.b)}};q.pc=function(){return[0,0,0]};q.vc=function(){return[0,0,0]};q.Ec=function(){return[[0,0],[1,0],[0,1]]}; q.fc=function(){var a=1*Sa,b=1*Ta;if(null!=q.b){var c=q.na,d=Pa(q.b)/800,a=a*d,b=b*d,g=q.U(q.ob()[0]),d=[-Math.sin(g),Math.cos(g)],g=[Math.cos(g),Math.sin(g)];q.b.a[0]+=d[0]*b-g[0]*a;q.b.a[1]+=d[1]*b-g[1]*a;0<q.j.ba[0]&&c.D.push([d[0]*b-g[0]*a,d[1]*b-g[1]*a]);I(q.b)}};q.rotate=function(a,b,c){if(null!=q.b){var d=q.na;null==c&&(c=0);q.b.e[0]+=0.3*-a;q.b.e[1]+=0.3*-b;q.b.e[2]+=0.3*c;0<q.j.ba[1]&&d.t.push([0.3*-a,0.3*-b,0.3*c]);I(q.b)}}; q.zoom=function(a){if(null!=q.b){var b=q.na;a=1+0.001*a;q.b.a[2]*=a;0<q.j.ba[2]&&b.P.push([a]);I(q.b)}};q.Wb=function(){var a=q.b.a[0],b=q.b.a[1];if(null!=q.b)return q.ua(s([a,b]),q.b.I)}; q.ec=function(){if(null!=q.b){for(var a=q.na,b=!1,c=q.j.ba[0],d=q.j.ba[1],g=q.j.ba[2],f=0;f<a.D.length;f++)a.D[f][0]*=c,a.D[f][1]*=c,q.b.a[0]+=a.D[f][0],q.b.a[1]+=a.D[f][1],0.01>Math.abs(a.D[f][0])+Math.abs(a.D[f][1])&&(a.D.splice(f,1),f--),b=!0;for(f=0;f<a.P.length;f++)a.P[f][0]+=(1-a.P[f][0])*(1-g),q.b.a[2]*=a.P[f][0],0.001>Math.abs(1-a.P[f][0])&&(a.P.splice(f,1),f--),b=!0;for(f=0;f<a.t.length;f++)a.t[f][0]*=d,a.t[f][1]*=d,a.t[f][2]*=d,q.b.e[0]+=a.t[f][0],q.b.e[1]+=a.t[f][1],q.b.e[2]+=a.t[f][2], 0.01>Math.abs(a.t[f][0])+Math.abs(a.t[f][1])+Math.abs(a.t[f][2])&&(a.t.splice(f,1),f--),b=!0;!0==b&&I(q.b)}};function Ua(a,b){!1==a&&alert("Vadstena3D initialization failed. Reason: "+b)}var Va=!1,Wa=!1,Xa=!1,Ya=!1,Za=!1,$a=0,ab=0,Sa=0,Ta=0;function bb(a){var b=!1;a=a||window.event;a.which?b=3==a.which:a.button&&(b=2==a.button);!0==b?Ya=!0:Za=!0}function cb(a){var b=!1;a=a||window.event;a.which?b=3==a.which:a.button&&(b=2==a.button);!0==b?Ya=!1:Za=!1} function db(a){var b=a.clientX;a=a.clientY;Sa=b-$a;Ta=a-ab;$a=b;ab=a;!0==Za&&!0!=Va&&!0!=Wa&&!0!=Xa&&q.fc();!0!=Ya&&(!0!=Za||!0!=Va&&!0!=Wa&&!0!=Xa)||q.rotate(1*Sa,1*Ta)}function eb(a){a.preventDefault&&a.preventDefault();a.returnValue=!1;var b=0,b=a.wheelDelta,b=(a=a.detail)?b?b/a/40*(0<=a?1:-1):-a/3:b/120;!0==isNaN(b)&&(b=0);b=0>b?1:-1;"observer"==q.Vb()?q.zoom(50*b):q.zoom(20*b)}function fb(a){"undefined"==typeof a&&(a=window.event);Va=a.altKey;Wa=a.ctrlKey;Xa=a.shiftKey} function gb(a){"undefined"==typeof a&&(a=window.event);if(a)switch(window.event?window.event.keyCode:a.which?a.which:a.charCode){case 49:q.$a("manual");break;case 50:q.$a("drone");break;case 51:q.$a("observer")}Va=a.altKey;Wa=a.ctrlKey;Xa=a.shiftKey} window.startDemo=function(){!1==q.Sb()?alert("Unfurtunately, Vadstena3D needs browser support for WebGL. Sorry."):(q.Ra("demo","./mapConfig.json",null,Ua),document.onmousedown=bb,document.oncontextmenu=function(){return!1},document.onmouseup=cb,document.onmousemove=db,window.addEventListener("DOMMouseScroll",eb,!0),window.addEventListener("mousewheel",eb,!0),document.onselectstart=function(){return!1},document.onkeyup=gb,document.onkeypress=gb,document.onkeydown=fb)};</script>
</head>
<body style = "padding: 0; margin: 0;" onload="startDemo()">
<div id="demo" style="width:100%; height:100%;"></div>
<div style="position:absolute;left:0px;bottom:0px; width:100%; height: 50px; background-color: rgba(0,0,0,0.85);">
<img style="padding-left:10px;padding-top:10px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMUAAAAeCAYAAACcwdocAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1NThDQTU2QTA2OTRFMzExQkVBNUJERDYzRjYwNzdDNiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCMEY0NzI2RTk0MDcxMUUzOEIyOEZBRjZCNkZDRTBFNyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCMEY0NzI2RDk0MDcxMUUzOEIyOEZBRjZCNkZDRTBFNyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjU2OENBNTZBMDY5NEUzMTFCRUE1QkRENjNGNjA3N0M2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU1OENBNTZBMDY5NEUzMTFCRUE1QkRENjNGNjA3N0M2Ii8+IDwvcmRmOkRlc2NyaXB0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">
</div>
</body>
</html>