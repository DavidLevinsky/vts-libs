<html>
<head>
<title>Vadstena Map Viewer</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<script type="text/javascript">var e,q={};window.Vadstena=q;glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;function s(a){var b=new glMatrixArrayType(2);a&&(b[0]=a[0],b[1]=a[1]);return b}function t(a){var b=new glMatrixArrayType(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b}function u(a){var b=new glMatrixArrayType(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b} function v(a){var b=new glMatrixArrayType(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b} function w(a,b){if(b&&a!=b)b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];else{var c=a[1],d=a[2],g=a[3],f=a[6],h=a[7],k=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=f;a[11]=a[14];a[12]=g;a[13]=h;a[14]=k}} function x(a,b,c){c||(c=a);var d=a[0],g=a[1],f=a[2],h=a[3],k=a[4],l=a[5],m=a[6],n=a[7],p=a[8],r=a[9],z=a[10],J=a[11],K=a[12],L=a[13],M=a[14];a=a[15];var N=b[0],O=b[1],P=b[2],Q=b[3],R=b[4],S=b[5],T=b[6],U=b[7],V=b[8],W=b[9],X=b[10],Y=b[11],Z=b[12],$=b[13],aa=b[14];b=b[15];c[0]=N*d+O*k+P*p+Q*K;c[1]=N*g+O*l+P*r+Q*L;c[2]=N*f+O*m+P*z+Q*M;c[3]=N*h+O*n+P*J+Q*a;c[4]=R*d+S*k+T*p+U*K;c[5]=R*g+S*l+T*r+U*L;c[6]=R*f+S*m+T*z+U*M;c[7]=R*h+S*n+T*J+U*a;c[8]=V*d+W*k+X*p+Y*K;c[9]=V*g+W*l+X*r+Y*L;c[10]=V*f+W*m+X*z+Y* M;c[11]=V*h+W*n+X*J+Y*a;c[12]=Z*d+$*k+aa*p+b*K;c[13]=Z*g+$*l+aa*r+b*L;c[14]=Z*f+$*m+aa*z+b*M;c[15]=Z*h+$*n+aa*J+b*a}function ba(a,b,c){c||(c=b);var d=b[0],g=b[1];b=b[2];c[0]=a[0]*d+a[4]*g+a[8]*b+a[12];c[1]=a[1]*d+a[5]*g+a[9]*b+a[13];c[2]=a[2]*d+a[6]*g+a[10]*b+a[14]} quat4={create:function(a){var b=new glMatrixArrayType(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},Ac:function(a,b){var c=a[0],d=a[1],g=a[2];if(!b||a==b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-g*g)),a;b[0]=c;b[1]=d;b[2]=g;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-g*g));return b},inverse:function(a,b){if(!b||a==b)return a[0]*=1,a[1]*=1,a[2]*=1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b},length:function(a){var b= a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1],g=a[2],f=a[3],h=Math.sqrt(c*c+d*d+g*g+f*f);if(0==h)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;h=1/h;b[0]=c*h;b[1]=d*h;b[2]=g*h;b[3]=f*h;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],g=a[1],f=a[2];a=a[3];var h=b[0],k=b[1],l=b[2];b=b[3];c[0]=d*b+a*h+g*l-f*k;c[1]=g*b+a*k+f*h-d*l;c[2]=f*b+a*l+d*k-g*h;c[3]=a*b-d*h-g*k-f*l;return c},Ec:function(a,b,c){c||(c=b);var d=b[0],g=b[1],f=b[2];b=a[0]; var h=a[1],k=a[2];a=a[3];var l=a*d+h*f-k*g,m=a*g+k*d-b*f,n=a*f+b*g-h*d,d=-b*d-h*g-k*f;c[0]=l*a+d*-b+m*-k-n*-h;c[1]=m*a+d*-h+n*-b-l*-k;c[2]=n*a+d*-k+l*-h-m*-b;return c},Lc:function(a,b){b||(b=new glMatrixArrayType(9));var c=a[0],d=a[1],g=a[2],f=a[3],h=c+c,k=d+d,l=g+g,m=c*h,n=c*k,c=c*l,p=d*k,d=d*l,g=g*l,h=f*h,k=f*k,f=f*l;b[0]=1-(p+g);b[1]=n-f;b[2]=c+k;b[3]=n+f;b[4]=1-(m+g);b[5]=d-h;b[6]=c-k;b[7]=d+h;b[8]=1-(m+p);return b},Mc:function(a,b){b||(b=v());var c=a[0],d=a[1],g=a[2],f=a[3],h=c+c,k=d+d,l=g+g, m=c*h,n=c*k,c=c*l,p=d*k,d=d*l,g=g*l,h=f*h,k=f*k,f=f*l;b[0]=1-(p+g);b[1]=n-f;b[2]=c+k;b[3]=0;b[4]=n+f;b[5]=1-(m+g);b[6]=d-h;b[7]=0;b[8]=c-k;b[9]=d+h;b[10]=1-(m+p);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},Jc:function(a,b,c,d){d||(d=a);var g=c;0>a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]&&(g=-1*c);d[0]=1-c*a[0]+g*b[0];d[1]=1-c*a[1]+g*b[1];d[2]=1-c*a[2]+g*b[2];d[3]=1-c*a[3]+g*b[3];return d},Kc:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}}; q.cc=function(a,b,c,d,g,f){var h=b-a,k=d-c,l=f-g;a=v([2*g/h,0,(b+a)/h,0,0,2*g/k,(d+c)/k,0,0,0,-(f+g)/l,-2*f*g/l,0,0,-1,0]);w(a);return a};q.pc=function(a,b,c,d){a=c*Math.tan(a*Math.PI/360);b*=a;return q.cc(-b,b,-a,a,c,d)};q.ra=function(a,b){var c=Math.cos(b),d=Math.sin(b);switch(a){case 0:c=v([1,0,0,0,0,c,-d,0,0,d,c,0,0,0,0,1]);break;case 1:c=v([c,0,-d,0,0,1,0,0,d,0,c,0,0,0,0,1]);break;default:c=v([c,-d,0,0,d,c,0,0,0,0,1,0,0,0,0,1])}w(c);return c}; q.Ga=function(a,b,c){a=v([a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1]);w(a);return a};q.tc=function(a){return q.Ga(a,a,a)};q.ha=function(a,b,c){a=v([1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1]);w(a);return a};q.Nc=function(a){return q.ha(a[0],a[1],0)};q.Oc=function(a){return q.ha(a[0],a[1],a[2])};q.aa=function(a,b,c){a<b?a=b:a>c&&(a=c);return a};q.Y=function(a){return a*Math.PI/180};q.Kb=function(a){a+="";return 7<=a.length?a:Array(7-a.length+1).join("0")+a}; q.uc=function(a,b){return a.replace(/\{([_$a-zA-Z0-9][_$a-zA-Z0-9]*)\}/g,function(a,d){return d in b?b[d]:a})};q.Cb=function(a,b,c){var d=new XMLHttpRequest;d.onload=function(){var a=d.response;try{var f=eval("("+a+")")}catch(h){null!=c&&c();return}null!=b&&b(f)}.bind(this);d.onerror=function(){null!=c&&c()}.bind(this);d.open("GET",a,!0);d.send("")}; q.Bb=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){switch(d.readyState){case 0:case 1:case 2:case 3:break;case 4:if(404==d.status){null!=c&&c();break}var a=new DataView(d.response);null!=b&&b(a);break;default:null!=c&&c()}}.bind(this);d.onerror=function(){null!=c&&c()}.bind(this);d.open("GET",a,!0);d.responseType="arraybuffer";d.send("")};window.performance=window.performance||{}; performance.now=performance.now||performance.Cc||performance.Dc||performance.Fc||performance.webkitNow||function(){return(new Date).getTime()}; function ca(a,b){this.A=new y;this.Fb=this.Gb=this.rb=0;this.wa=[];this.nb=u();this.Yb=b;this.Qb=this.Eb=this.Hb="";null!=a.foat&&(this.A.i=a.foat[0],this.A.k=a.foat[1],this.A.l=a.foat[2],this.rb=a.foat[3]);null!=a.meta&&(this.Gb=a.meta[0],this.Fb=a.meta[1]);this.Hb=a.metaTemplate;this.Eb=a.meshTemplate;this.Qb=a.textureTemplate;if(null!=a.defaultPosition&&null!=a.defaultOrientation)for(var c=0;3>c;c++)this.wa[c]=a.defaultPosition[c],this.nb[c]=a.defaultOrientation[c]} function A(a,b){return a.rb>>b-a.A.i}function da(a){var b=q.p;return ea(b,b.Hb,a)}function fa(a){var b=q.p;return ea(b,b.Eb,a)}function ga(a){var b=q.p;return ea(b,b.Qb,a)}function ea(a,b,c){b=q.uc(b,{lod:c.i,easting:q.Kb(c.k),northing:q.Kb(c.l)});return a.Yb+b}function ha(a,b){var c=q.p,d=A(c,12),g=Math.round((a[0]-c.A.k)/d),f=Math.round((a[1]-c.A.l)/d);return null!=b?(b[0]=c.A.k+g*d,b[1]=c.A.l+f*d,b[2]=a[2],b):u([c.A.k+g*d,c.A.l+f*d,a[2]])} function ia(a){this.Oa=1073741824;this.ub=402653184;this.na=4;this.kb=45;this.lb=20;this.ib=4E4;this.wb=8;this.xb=32;this.ba=[0.8,0.8,0.8];this.V="observer";if(null!=a&&(null!=a.cacheSize&&(this.Oa=a.cacheSize),null!=a.gpuCacheSize&&(this.ub=a.gpuCacheSize),null!=a.numThreads&&(this.na=a.numThreads),null!=a.cameraFOV&&(this.kb=a.cameraFOV),null!=a.cameraNear&&(this.lb=a.cameraNear),null!=a.visibility&&(this.ib=a.visibility),null!=a.gridEmbeddingFactor&&(this.wb=a.gridEmbeddingFactor),null!=a.gridMinTileSize&& (this.xb=a.gridMinTileSize),null!=a.controlMode&&(this.V=a.controlMode),null!=a.controlInertia))for(var b=0;3>b;b++)this.ba[b]=a.controlInertia[b]}function ja(a,b,c,d,g,f){this.d=[];this.f=[];this.d[0]=null!=a?a:Number.POSITIVE_INFINITY;this.d[1]=null!=b?b:Number.POSITIVE_INFINITY;this.d[2]=null!=c?c:Number.POSITIVE_INFINITY;this.f[0]=null!=d?d:Number.NEGATIVE_INFINITY;this.f[1]=null!=g?g:Number.NEGATIVE_INFINITY;this.f[2]=null!=f?f:Number.NEGATIVE_INFINITY}function B(a,b){return a.f[b]-a.d[b]} function ka(a,b){return new ja(a.d[0]-b[0],a.d[1]-b[1],a.d[2],a.f[0]-b[0],a.f[1]-b[1],a.f[2])}function la(a){this.ea=[];this.ya=null!=a?a:Number.MAX_VALUE;this.ga=0}e=la.prototype;e.log=function(){for(var a=0,b=this.N;null!=b.X&&!(b=this.ea[b.X][3],a++,10<a););this.ea.forEach(function(){})};e.find=function(a){a=this.hash(a);a=this.ea[a];if(null!=a){if(this.N!=a){null!=a.T&&(a.T.X=a.X);null!=a.X&&(a.X.T=a.T);this.W==a&&(this.W=a.T);var b=this.N;this.N=a;this.N.X=b;this.N.T=null;b.T=this.N}return a.Ab}return null}; e.contains=function(a){return null!=this.ea[this.hash(a)]};e.clear=function(){this.ea=[]};function ma(a,b,c,d){b=a.hash(b);c={fc:b,Ab:c,$b:d,T:null,X:a.N};null!=a.N&&(a.N.T=c);a.N=c;null==a.W&&(a.W=c);a.ea[b]=c;a.ga+=d;na(a)}function na(a){for(;a.ga>a.ya;){var b=a.W;if(null!=b)a.W=a.W.T,null!=a.W&&(a.W.X=null),a.ea[b.fc]=null,a.ga-=b.$b,b.Ab.O();else break}}e.hash=function(a){return""+Math.round(a.i)+"."+Math.round(a.k)+"."+Math.round(a.l)}; function oa(a,b,c,d){null==c&&(c=1);this.na=c;this.Ma=0;this.v=new la(a);this.fa=[];this.Aa=[];this.da=[];this.Ib=b;this.ob=d}e=oa.prototype;e.O=function(){};e.get=function(a){var b=this.v.find(a);null==b&&this.Za(a);return b};e.contains=function(a){return this.v.contains(a)};e.trim=function(a){var b=this.v.ya,c=this.v;c.ya=a;na(c);a=this.v;a.ya=b;na(a)};e.reset=function(){this.v.clear()};e.size=function(){return this.v.ga}; e.Za=function(a){var b=this.v.hash(a),c=this.da.indexOf(b);-1==c&&(c=this.fa.indexOf(b),-1!=c&&(this.fa.splice(c,1),this.Aa.splice(c,1)),this.fa.unshift(b),this.Aa.unshift(a),20<this.fa.length&&(this.fa.pop(),this.Aa.pop()))}; e.update=function(){if(0<this.fa.length&&this.Ma<this.na){var a=this.fa.shift(),b=this.Aa.shift();if(-1==this.da.indexOf(a)){this.da.push(a);this.Ma++;var a=function(a,b){this.da.splice(this.da.indexOf(this.v.hash(a)),1);this.Ma--;ma(this.v,a,b,b.size());null!=this.Ib&&this.Ib(a)}.bind(this),c=function(a){this.da.splice(this.da.indexOf(this.v.hash(a)),1);this.Ma--}.bind(this);null!=this.ob&&new this.ob(b,a,c)}}}; function pa(a,b,c){this.a=u([0,0,0]);this.g=u([0,0,0]);this.jb=1;this.sb=a;this.Ya=b;this.Qa=c;this.S=v();this.Ca=v();this.za=v();this.Q=[t(),t(),t(),t(),t(),t()];this.Mb=t();this.q=!0}e=pa.prototype;e.Ia=function(a){this.a=a;this.q=!0};e.Ha=function(a){this.g=a;this.q=!0};e.ka=function(){return u(this.a)};e.tb=function(){return u(this.g)};function qa(a){a.q&&a.update();return a.S}function ra(a){a.q&&a.update();return a.Ca} function sa(a,b){a.q&&a.update();for(var c=[[b.d[0],b.d[1],b.d[2],1],[b.d[0],b.d[1],b.f[2],1],[b.d[0],b.f[1],b.d[2],1],[b.d[0],b.f[1],b.f[2],1],[b.f[0],b.d[1],b.d[2],1],[b.f[0],b.d[1],b.f[2],1],[b.f[0],b.f[1],b.d[2],1],[b.f[0],b.f[1],b.f[2],1]],d=0;6>d;d++){for(var g=!0,f=0;8>f;f++){var h=a.Q[d],k=c[f];if(0<h[0]*k[0]+h[1]*k[1]+h[2]*k[2]+h[3]*k[3]){g=!1;break}}if(g)return!1}return!0} e.update=function(){this.S=v();x(q.ra(1,q.Y(-this.g[2])),q.ra(0,q.Y(-this.g[1]-90)),this.S);x(this.S,q.ra(2,q.Y(-this.g[0])),this.S);x(this.S,q.ha(-this.a[0],-this.a[1],-this.a[2]),this.S);this.Ca=q.pc(this.sb,this.jb,this.Ya,this.Qa);this.za=v();x(this.Ca,this.S,this.za);this.Q[0]=t([0,0,1,1]);this.Q[1]=t([0,0,-1,1]);this.Q[2]=t([1,0,0,1]);this.Q[3]=t([-1,0,0,1]);this.Q[4]=t([0,1,0,1]);this.Q[5]=t([0,-1,0,1]);var a=v();w(this.za,a);for(var b=0;6>b;b++){var c=this.Q,d=b,g=a,f=this.Q[b],h=void 0,h= f,k=f[0],l=f[1],m=f[2],f=f[3];h[0]=g[0]*k+g[4]*l+g[8]*m+g[12]*f;h[1]=g[1]*k+g[5]*l+g[9]*m+g[13]*f;h[2]=g[2]*k+g[6]*l+g[10]*m+g[14]*f;h[3]=g[3]*k+g[7]*l+g[11]*m+g[15]*f;c[d]=h}this.q=!1}; q.Pb=function(a,b,c,d,g){var f=d.get(b);if(!f)return[c,b.i>=g];var h=A(q.p,b.i);c=(a[0]-b.k)/h;h=(a[1]-b.l)/h;c=q.aa(c,0,0.9999);var h=q.aa(h,0,0.9999),k=c*(q.C-1),l=h*(q.C-1),m=Math.floor(k),n=Math.floor(l),p=f.G[n*q.C+m],r=f.G[(n+1)*q.C+m],k=k-m,p=p+(f.G[n*q.C+m+1]-p)*k,l=p+(r+(f.G[(n+1)*q.C+m+1]-r)*k-p)*(l-n),m=0,m=0.5>h?0.5>c?0:1:0.5>c?2:3;return!(f.L&1<<m)||b.i>=g?[l,!0]:q.Pb(a,C(b,m),l,d)};q.ua=function(a,b){var c;null==c&&(c=Number.MAX_VALUE);return q.Pb(a,q.p.A,0,b,c)}; function ta(a,b){this.c=null;this.xa=a;this.t=null;this.D=b;this.mb=null}e=ta.prototype; e.Ua=function(){this.t=document.createElement("canvas");if(null!=this.t&&(this.t.width=this.D[0],this.t.height=this.D[1],this.t.style.display="block",null!=this.t.getContext)){try{this.c=this.t.getContext("webgl")||this.t.getContext("experimental-webgl")}catch(a){}this.c&&(q.c=this.c,this.xa.appendChild(this.t),this.c.hb=this.t.width,this.c.gb=this.t.height,this.c.clearColor(0,0,0,1),this.c.enable(this.c.DEPTH_TEST),this.c.viewport(0,0,this.c.hb,this.c.gb),this.c.clear(this.c.COLOR_BUFFER_BIT|this.c.DEPTH_BUFFER_BIT))}}; e.resize=function(a){this.D=a;null!=this.t&&(this.t.width=this.D[0],this.t.height=this.D[1]);null!=this.c&&(this.c.hb=this.t.width,this.c.gb=this.t.height)};e.clear=function(){this.c.viewport(0,0,this.c.hb,this.c.gb);this.c.clear(this.c.DEPTH_BUFFER_BIT);this.c.enable(this.c.CULL_FACE)};e.useProgram=function(a,b,c){this.mb!=a&&(this.c.useProgram(a.P),this.mb=a,ua(a),b=a.getAttribute(b),a=a.getAttribute(c),this.c.enableVertexAttribArray(b),this.c.enableVertexAttribArray(a))}; e.bindTexture=function(a){!1!=a.Xa&&(this.c.activeTexture(this.c.TEXTURE0),this.c.bindTexture(this.c.TEXTURE_2D,a.K))};q.zc=function(){return!0}; function D(a){this.e=a.e;var b=q.c;null!=b&&(this.ia=this.U=null,this.U=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.U),b.bufferData(b.ARRAY_BUFFER,new Float32Array(a.m),b.STATIC_DRAW),this.U.Va=3,this.U.$a=a.m.length/3,this.ia=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this.ia),b.bufferData(b.ARRAY_BUFFER,new Float32Array(a.o),b.STATIC_DRAW),this.ia.Va=2,this.ia.$a=a.o.length/2,this.J=4*(a.m.length+a.o.length)+32,this.ab=this.U.$a/3)} D.prototype.O=function(){var a=q.c;a.deleteBuffer(this.U);a.deleteBuffer(this.ia)};function va(a,b){var c=q.c;if(null!=c){var d=b.getAttribute("aPosition"),g=b.getAttribute("aTexCoord");c.bindBuffer(c.ARRAY_BUFFER,a.U);c.vertexAttribPointer(d,a.U.Va,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,a.ia);c.vertexAttribPointer(g,a.ia.Va,c.FLOAT,!1,0,0);c.drawArrays(c.TRIANGLES,0,a.U.$a)}}D.prototype.size=function(){return this.J}; function E(a,b){this.P=null;this.fb=[];this.Na=[];this.createProgram(a,b)}E.prototype.createShader=function(a,b){if(!a)return null;var c=q.c;if(null!=c){var d;d=!0!=b?c.createShader(c.FRAGMENT_SHADER):c.createShader(c.VERTEX_SHADER);c.shaderSource(d,a);c.compileShader(d);return c.getShaderParameter(d,c.COMPILE_STATUS)?d:(alert("An error occurred compiling the shaders: "+c.getShaderInfoLog(d)),null)}}; E.prototype.createProgram=function(a,b){var c=q.c;if(null!=c){var d=this.createShader(a,!0),g=this.createShader(b,!1),f=c.createProgram();c.attachShader(f,d);c.attachShader(f,g);c.linkProgram(f);c.getProgramParameter(f,c.LINK_STATUS)||alert("Unable to initialize the shader program.");c.useProgram(f);this.P=f}};function ua(a){var b=q.c;null!=b&&null!=a.P&&(a=a.getUniform("uSampler"),null!=a&&b.uniform1i(a,0))} function F(a,b,c){var d=q.c;null!=d&&null!=a.P&&(a=a.getUniform(b),null!=a&&d.uniformMatrix4fv(a,!1,c))}function wa(a,b,c){var d=q.c;null!=d&&null!=a.P&&(a=a.getUniform(b),null!=a&&d.uniform1f(a,c))}E.prototype.getAttribute=function(a){var b=q.c;if(null!=b&&null!=this.P)return null==this.Na[a]?(b=b.getAttribLocation(this.P,a),this.Na[a]=b):this.Na[a]};E.prototype.getUniform=function(a){var b=q.c;if(null!=b&&null!=this.P)return null==this.fb[a]?(b=b.getUniformLocation(this.P,a),this.fb[a]=b):this.fb[a]}; q.wc="#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMVP;\nvarying vec2 vTexCoord;\nvoid main(){ \ngl_Position = uMVP * vec4(aPosition, 1.0);\nvTexCoord = aTexCoord;\n}";q.vc="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nconst vec4 gray = vec4(0.125, 0.125, 0.125, 1.0);\nvoid main() {\nfloat fade = smoothstep(0.49, 0.52, vTexCoord.t);\ngl_FragColor = mix(texture2D(uSampler, vTexCoord), gray, fade);\n}"; q.ic="#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nuniform mat4 uGridMat;\nuniform float uGridStep1, uGridStep2;\nconst int HMSize = 5;\nconst float HMSize1 = float(HMSize-1);\nuniform float uHeight[HMSize*HMSize];\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nfloat round(float x) { return floor(x + 0.5); }\nvoid main() {\nvec3 pos = aPosition;\nfloat z = uHeight[int(round(pos.y*HMSize1)*float(HMSize) + round(pos.x*HMSize1))];\nvec4 camSpacePos = uMV * vec4(pos.xy, z, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvec4 gridCoord = uGridMat * vec4(pos, 1.0);\nvTexCoord1 = aTexCoord;\nvTexCoord1 = gridCoord.xy * vec2(uGridStep1);\nvTexCoord2 = gridCoord.xy * vec2(uGridStep2);\n}"; q.gc="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D uSampler;\nuniform float uGridBlend;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nconst vec4 fogColor = vec4(1, 1, 1, 1);\nvoid main() {\nvec4 gridColor = mix(texture2D(uSampler, vTexCoord1), texture2D(uSampler, vTexCoord2), uGridBlend);\ngl_FragColor = mix(fogColor, gridColor, vFogFactor);\n}";q.yc="#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvTexCoord = aTexCoord;\n}"; q.xc="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nconst vec4 fogColor = vec4(1, 1, 1, 1);\nvoid main() {\ngl_FragColor = mix(fogColor, texture2D(uSampler, vTexCoord), vFogFactor);\n}";function G(a){this.K=null;this.J=0;this.u=null;this.Xa=!1;null!=a&&this.load(a)}G.prototype.O=function(){q.c.deleteTexture(this.K)};G.prototype.size=function(){return this.J}; function xa(a,b,c){var d=q.c;a.K=d.createTexture();d.bindTexture(d.TEXTURE_2D,a.K);c=!0==c?d.REPEAT:d.CLAMP_TO_EDGE;d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,c);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,c);c=!1;switch("linear"){case "linear":d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);break;case "trilinear":d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER, d.LINEAR);c=!0;break;default:d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST)}d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b);!0==c&&d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null);a.J=b.naturalWidth*b.naturalHeight*4;a.Xa=!0} G.prototype.load=function(a,b,c){this.u=new Image;this.u.crossOrigin="anonymous";this.u.onload=function(){xa(this,this.u,!1);this.u=null}.bind(this);this.u.onerror=function(){null!=c&&c()}.bind(this);this.u.src=a};function ya(a){this.F=new D(a.F);this.K=new G;xa(this.K,a.u)}ya.prototype.O=function(){this.F.O();this.K.O()};ya.prototype.size=function(){return this.F.size()+this.K.size()};function za(a){this.v=new la(a)} za.prototype.get=function(a,b){var c=this.v.find(a);if(c)return c;c=new ya(b);ma(this.v,a,c,c.size());return c};za.prototype.size=function(){return this.v.ga};function H(){this.m=[];this.o=[];this.e=new ja} H.prototype.load=function(a,b,c){q.Bb(a,function(a){for(var c=0,f=1/65535,h="",k=0;8>k;k++)h+=String.fromCharCode(a.getUint8(c,!0)),c+=1;if("BIN.MESH"==h&&(k=a.getUint32(c,!0),c+=4,!(1<k))){for(k=0;3>k;k++)this.e.d[k]=a.getFloat64(c,!0),c+=8;for(k=0;3>k;k++)this.e.f[k]=a.getFloat64(c,!0),c+=8;for(var h=a.getUint16(c,!0),c=c+2,l=Array(3*h),m=0;m<h;m++)k=3*m,l[k]=a.getUint16(c,!0),c+=2,l[k+1]=a.getUint16(c,!0),c+=2,l[k+2]=a.getUint16(c,!0),c+=2;for(var h=a.getUint16(c,!0),c=c+2,n=Array(2*h),m=0;m<h;m++)k= 2*m,n[k]=a.getUint16(c,!0),c+=2,n[k+1]=65535-a.getUint16(c,!0),c+=2;h=a.getUint16(c,!0);c+=2;this.m=Array(9*h);this.o=Array(6*h);for(m=0;m<h;m++){for(k=0;3>k;k++){var p=3*a.getUint16(c,!0),c=c+2,r=9*m+3*k;this.m[r]=l[p]*f;this.m[r+1]=l[p+1]*f;this.m[r+2]=l[p+2]*f}for(k=0;3>k;k++)p=2*a.getUint16(c,!0),c+=2,r=6*m+2*k,this.o[r]=n[p]*f,this.o[r+1]=n[p+1]*f}this.J=8*(this.m.length+this.o.length)+56;null!=b&&b()}}.bind(this),function(){null!=c&&c()}.bind(this))};H.prototype.size=function(){return this.J}; q.Ja=function(a,b){b*=Math.PI;a=2*a*Math.PI;return u([Math.cos(a)*Math.sin(b)*0.5+0.5,Math.sin(a)*Math.sin(b)*0.5+0.5,0.5*Math.cos(b)+0.5])};q.C=5; function Aa(a,b){this.e=new ja;this.Ba=[];this.G=[];this.L=0;this.sa=[];for(var c=0;2>c;c++)this.Ba[c]=[];var d=b.ca.getUint16(b.n,!0);b.n+=2;c=b.ca.getUint16(b.n,!0);b.n+=2;this.e.d[0]=a.k;this.e.d[1]=a.l;this.e.d[2]=d;d=A(q.p,a.i);this.e.f[0]=a.k+d;this.e.f[1]=a.l+d;this.e.f[2]=c;for(c=0;2>c;c++)for(d=0;2>d;d++)this.Ba[c][d]=b.ca.getFloat32(b.n,!0),b.n+=4;c=0;for(d=q.C*q.C;c<d;c++)this.G[c]=b.ca.getInt16(b.n,!0),b.n+=2;for(c=0;4>c;c++)this.sa[c]=null;this.L=0} Aa.prototype.la=function(a,b){var c=b;null!=c?(c[0]=B(this.e,0),c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=B(this.e,1),c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=this.e.d[0]-a[0],c[13]=this.e.d[1]-a[1],c[14]=0,c[15]=1):(c=v(),x(q.ha(this.e.d[0]-a[0],this.e.d[1]-a[1],0),q.Ga(B(this.e,0),B(this.e,1),1),c));return c};Aa.prototype.size=function(){for(var a=304,b=0;4>b;b++)null!=this.sa[b]&&(a+=this.sa[b].size());return a}; function Ba(a,b){this.r=a;for(var c="",d=0;8>d;d++)c+=String.fromCharCode(b.ca.getUint8(b.n,!0)),b.n+=1;"METATILE"==c&&(c=b.ca.getUint32(b.n,!0),b.n+=4,1<c||(this.Rb=Ca(this,a,b)))}Ba.prototype.O=function(){};function Ca(a,b,c){var d=new Aa(b,c),g=c.ca.getUint8(c.n,!0);c.n+=1;for(var f=0;4>f;f++)g&1<<f+4&&(d.sa[f]=Ca(a,C(b,f),c));d.L=g&15;return d}Ba.prototype.size=function(){return this.Rb.size()}; q.Vb=function(a,b,c){this.r=a;this.pa=b;this.oa=c;this.kc=function(a){null!=this.pa&&(a=new Ba(this.r,{ca:a,n:0}),this.pa(this.r,a))}.bind(this);this.jc=function(){null!=this.oa&&this.oa(this.r)}.bind(this);q.Bb(da(this.r),this.kc,this.jc)}; function Da(a,b,c,d){this.w=new oa(a,b,c,d);this.O=this.w.O.bind(this.w);this.contains=this.w.contains.bind(this.w);this.trim=this.w.trim.bind(this.w);this.reset=this.w.reset.bind(this.w);this.Za=this.w.Za.bind(this.w);this.update=this.w.update.bind(this.w);this.size=this.w.size.bind(this.w)} Da.prototype.get=function(a){for(var b=a,c=q.p;Math.abs(b.i-c.Gb)%c.Fb&&b.i>c.A.i;)b=b.parent();if(c=this.w.get(b)){b=new y(c.r.i,c.r.k,c.r.l);for(c=c.Rb;b.i<a.i;){var d=A(q.p,b.i),g=b.k+d/2,d=b.l+d/2,f=0;Math.round(a.k)>=Math.round(g)&&(f|=1,b.k=g);Math.round(a.l)>=Math.round(d)&&(f|=2,b.l=d);b.i++;(c=c.sa[f])||console.log("Missing tile metadata")}!b.isEqual(a)&&console.log("Metatile inconsistency");a=c}else a=null;return a};q.bb=1.1; function Ea(a,b){this.qa=this.I=this.ja=null;this.xa=a;this.Jb=b;this.D=[a.clientWidth,a.clientHeight];this.La=!1;this.q=this.yb=!0;this.R=new ta(a,this.D);this.h=new pa(q.j.kb,q.j.lb,q.j.ib);this.a=[q.p.wa[0],q.p.wa[1],q.p.wa[2]];this.g=u(q.p.nb);this.H=new Da(Number.MAX_VALUE,function(){this.q=!0}.bind(this),q.j.na,q.Vb);this.$=new q.Wb(Number.MAX_VALUE,function(){this.q=!0}.bind(this),q.j.na,q.Xb);this.vb=new za(q.j.ub);this.Nb=this.eb=this.Ta=this.Sa=null;this.Ub=this.hc=!1;this.Ob=document.getElementById("renderStats"); this.Da=this.Lb=this.Z=this.Ea=this.Fa=this.Ka=this.ta=0;this.Wa=null;this.Ra=0;this.qb=v();this.pb=v();this.ac=u();this.bc=v();this.qc=v();this.Tb=v();this.sc=u();this.rc=[[3,1,2,0],[3,2,1,0],[2,3,0,1],[2,0,3,1],[0,2,1,3],[0,1,2,3],[1,0,3,2],[1,3,0,2]];window.addEventListener("resize",function(){Fa(this,this.xa.clientWidth,this.xa.clientHeight)}.bind(this));this.R.Ua();this.ja=new E(q.yc,q.xc);this.I=new E(q.ic,q.gc);this.qa=new E(q.wc,q.vc);Ga(this);Ha(this);Fa(this,this.D[0],this.D[1]);window.requestAnimationFrame(this.update.bind(this))} function Ga(a){var b=new H,c=q.C;c--;for(var d=0;d<c;d++)for(var g=0;g<c;g++){var f=g/c,h=(g+1)/c,k=d/c,l=(d+1)/c;b.m.push(f,k,0);b.m.push(h,k,0);b.m.push(h,l,0);b.o.push(f,k);b.o.push(h,k);b.o.push(h,l);b.m.push(h,l,0);b.m.push(f,l,0);b.m.push(f,k,0);b.o.push(h,l);b.o.push(f,l);b.o.push(f,k)}b.e.d[0]=b.e.d[1]=b.e.d[2]=0;b.e.f[0]=b.e.f[1]=b.e.f[2]=1;b.J=8*(b.m.length+b.o.length)+56;a.Sa=new D(b);b=new Uint8Array(16384);for(c=0;64>c;c++)for(d=0;64>d;d++)g=4*(64*c+d),1>c||63<=c||1>d||63<=d?(b[g]=255, b[g+1]=255,b[g+2]=255):(b[g]=32,b[g+1]=32,b[g+2]=32),b[g+3]=255;a.Ta=new G;a=a.Ta;d=!0;c=q.c;a.K=c.createTexture();c.bindTexture(c.TEXTURE_2D,a.K);d=!0==d?c.REPEAT:c.CLAMP_TO_EDGE;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,d);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,d);d=!1;switch("trilinear"){case "linear":c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);break;case "trilinear":c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER, c.LINEAR_MIPMAP_LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);d=!0;break;default:c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST)}c.pixelStorei(c.UNPACK_ALIGNMENT,1);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,64,64,0,c.RGBA,c.UNSIGNED_BYTE,b);!0==d&&c.generateMipmap(c.TEXTURE_2D);c.bindTexture(c.TEXTURE_2D,null);a.J=16384;a.Xa=!0} function Ha(a){for(var b=new H,c=0;32>c;c++)for(var d=0;64>d;d++){var g=b,f=d/64,h=c/32,k=(d+1)/64,l=(c+1)/32,m=u(q.Ja(f,h)),n=s([f,h]),p=u(q.Ja(f,l)),f=s([f,l]),r=u(q.Ja(k,h)),h=s([k,h]),z=u(q.Ja(k,l)),k=s([k,l]);g.m.push(p[0],p[1],p[2]);g.m.push(m[0],m[1],m[2]);g.m.push(r[0],r[1],r[2]);g.o.push(f[0],f[1]);g.o.push(n[0],n[1]);g.o.push(h[0],h[1]);g.m.push(r[0],r[1],r[2]);g.m.push(z[0],z[1],z[2]);g.m.push(p[0],p[1],p[2]);g.o.push(h[0],h[1]);g.o.push(k[0],k[1]);g.o.push(f[0],f[1]);g.J=8*(g.m.length+ g.o.length)+56}b.e.d[0]=b.e.d[1]=b.e.d[2]=0;b.e.f[0]=b.e.f[1]=b.e.f[2]=1;a.eb=new D(b);a.Nb=new G("./skydome.jpg")}function Fa(a,b,c){var d=a.h;d.jb=b/c;d.q=!0;a.D=[b,c];a.R.resize(a.D);Ia(a)}function Ja(a){var b=Math.log(0.05)/q.j.ib;wa(a,"uFogDensity",b)} function Ka(a,b,c,d){if(c&&!a.hc)d=a.vb.get(b,c),a.R.useProgram(a.ja,"aPosition","aTexCoord"),b=a.qb,x(qa(a.h),c.la(a.a,a.bc),b),c=ra(a.h),F(a.ja,"uMV",b),F(a.ja,"uProj",c),Ja(a.ja),a.R.bindTexture(d.K),va(d.F,a.ja),a.Fa++,a.Z+=d.F.ab;else{a.R.useProgram(a.I,"aPosition","aTexCoord");b=a.qb;x(qa(a.h),d.la(a.a,a.pb),b);F(a.I,"uMV",b);F(a.I,"uProj",ra(a.h));c=a.pb;d.la(ha(a.a,a.ac),c);F(a.I,"uGridMat",c);Ja(a.I);c=q.j.wb;b=q.j.xb;var g=q.C,g=Math.log(a.h.a[2]-0.25*(d.G[0]+d.G[g-1]+d.G[(g-1)*g]+d.G[(g- 1)*g+g-1])+20)/Math.log(c),f=Math.pow(c,Math.ceil(g)),h=g-Math.floor(g);wa(a.I,"uGridStep1",b/Math.pow(c,Math.floor(g)));wa(a.I,"uGridStep2",b/f);wa(a.I,"uGridBlend",h);c=a.I;d=d.G;b=q.c;null!=b&&null!=c.P&&(c=c.getUniform("uHeight"),null!=c&&b.uniform1fv(c,d));a.R.bindTexture(a.Ta);va(a.Sa,a.I);a.Ea++;a.Z+=a.Sa.ab}} function La(a,b){for(var c=b.la(a.a,a.qc),d=a.D[0]/2,g=0,f=q.C,h=q.C-1,k=0;1>=k;k++)for(var l=0;1>=l;l++){var m=[];ba(c,[l,k,b.G[k*h*f+l*h]],m);var n=a.h;n.q&&n.update();ba(n.S,m,n.Mb);var m=n.Mb,p=m[0],r=m[1],m=m[2],m=Math.sqrt(p*p+r*r+m*m),n=(m<n.Ya?Number.POSITIVE_INFINITY:n.Ca[0]/m)*b.Ba[k][l]*d;n>g&&(g=n)}return g} function Ma(a,b){var c=a.H.get(b);if(!c||!sa(a.h,ka(c.e,a.a)))return 0;var d=La(a,c);if(!c.L||d<q.bb){var g=a.$.get(b),f;if(!(f=g)){a:if(c.L){for(f=0;4>f;f++)if(c.L&1<<f&&!a.$.contains(C(b,f))){f=!1;break a}f=!0}else f=!1;f=!f}f?Ka(a,b,g,c):Na(a,b,c);return d}if(d=2.2>d)a:{if(a.$.contains(b)&&1E4>c.Ba[0][0])for(d=0;4>d;d++)if(c.L&1<<d&&(g=C(b,d),!a.$.get(g))){a.H.get(g);d=!0;break a}d=!1}return d?(g=a.$.get(b),Ka(a,b,g,c),0):Na(a,b,c)} function Na(a,b,c){var d=a.rc,g;g=c.e;var f=a.sc;null!=f?(f[0]=0.5*(g.d[0]+g.f[0]),f[1]=0.5*(g.d[1]+g.f[1]),g=f):g=u([0.5*(g.d[0]+g.f[0]),0.5*(g.d[1]+g.f[1]),0.5*(g.d[2]+g.f[2])]);f=a.h.a;g=Math.floor((Math.atan2(a.a[1]+f[1]-g[1],a.a[0]+f[0]-g[0])+Math.PI)/Math.PI*4);g=q.aa(g,0,7);for(var h=f=0;4>h;h++){var k=d[g][h];c.L&1<<k&&(f=Math.max(f,Ma(a,C(b,k))))}return f} function Oa(a,b){var c=a.H.get(b);if(!c||!sa(a.h,ka(c.e,a.a)))return 0;var d=La(a,c);if(!c.L||d<q.bb)return d;for(var g=d=0;4>g;g++)c.L&1<<g&&(d=Math.max(d,Oa(a,C(b,g))));return d} function I(a){switch(q.j.V){case "observer":a.g[1]=q.aa(a.g[1],-90,10);a.a[2]=q.aa(a.a[2],5,8E3);x(q.ra(2,q.Y(a.g[0])),q.ra(0,q.Y(a.g[1])),a.Tb);var b=u([0,-a.a[2],0]);ba(a.Tb,b);b[2]+=q.ua(a.a,a.H)[0];a.h.Ia(b);a.h.Ha(a.g);break;case "drone":a.g[1]=q.aa(a.g[1],-90,90);a.a[2]=q.aa(a.a[2],5,8E3);b=a.h.a;a.h.Ia(u([0,0,a.a[2]+q.ua([a.a[0]+b[0],a.a[1]+b[1]],a.H)[0]]));a.h.Ha(a.g);break;case "manual":a.h.Ia(u([0,0,a.a[2]])),a.h.Ha(a.g)}a.q=!0} function Pa(a){var b=a.h.a;return a.h.ka()[2]-q.ua([a.a[0]+b[0],a.a[1]+b[1]],a.H)[0]}function Qa(a,b){var c=!1;if("manual"==q.j.V)return!1;for(;b>q.bb||0>Pa(a);){c=!0;if("observer"==q.j.V)if(a.La||-10<a.g[1])250>a.a[2]?a.a[2]+=0.3:a.g[1]-=0.3;else{var d=q.Y(a.g[0]),g=q.Y(-a.g[1]),f=0.5/Math.sin(g),g=f*Math.cos(g),d=[-Math.sin(d),Math.cos(d),0];a.a[0]+=g*d[0];a.a[1]+=g*d[1];a.a[2]+=f}else a.a[2]+=0.5;I(a);b=Oa(a,q.p.A)}return c} function Ia(a){if("drone"==q.j.V&&!a.yb){var b=q.ua(a.a,a.H);if(!b[1])return;a.a[2]+=b[0];a.yb=!0}b=0;do{a.R.clear();I(a);var b=Ma(a,q.p.A),c=a,d=v();x(q.Ga(2,2,2),q.ha(-0.5,-0.5,-0.5),d);var g=v();x(q.ha(c.h.ka()[0],c.h.ka()[1],c.h.ka()[2]-400),q.tc(0.9*c.h.Qa),g);var f=v(),h=c.h;h.q&&h.update();x(h.za,g,f);x(f,d,f);c.R.useProgram(c.qa,"aPosition","aTexCoord");c.R.bindTexture(c.Nb);ua(c.qa);F(c.qa,"uMVP",f);va(c.eb,c.qa);c.Z+=c.eb.ab}while(Qa(a,b));a.H.trim(q.j.Oa/10);a.$.trim(q.j.Oa);a.La=!1} Ea.prototype.update=function(){if(null!=q.b){null!=this.Jb&&this.Jb();this.H.update();this.$.update();if(!0==this.Ub&&(this.Z=this.Ea=this.Fa=0,this.ta++,10<=this.ta)){var a=Date.now();null!=this.Wa&&(this.Ra=0.5*(1E3/(a-this.Wa)*this.ta+this.Ra));this.Wa=a}a=performance.now();!0==this.q&&Ia(this);!0==this.Ub&&(this.Ka++,this.Da+=performance.now()-a,100<=this.Ka&&(this.Lb=this.Da/this.Ka,this.Ka=this.Da=0),null!=this.Ob&&10<=this.ta&&(this.ta=0,!0==this.q&&(this.Ob.innerHTML="Redered tiles: "+(this.Fa+ this.Ea)+"<br/>Terrain tiles: "+this.Fa+"<br/>Heightmap tiles: "+this.Ea+"<br/>Tile cache: "+Math.round(this.$.size()/1048576)+"MB<br/>Metatile cache: "+Math.round(this.H.size()/1048576)+"MB<br/>GPU cache: "+Math.round(this.vb.size()/1048576)+"MB<br/>Polygons: "+this.Z+"<br/>Render time: "+Math.round(1E3*this.Lb)+"<br/>FPS: "+Math.round(this.Ra))));this.q=!1;window.requestAnimationFrame(this.update.bind(this))}}; function Ra(a,b,c){this.r=a;this.F=b;this.u=c;this.J=this.F.size()+c.naturalWidth*c.naturalHeight*3}Ra.prototype.O=function(){this.u=this.F=null};Ra.prototype.la=function(a,b){var c=A(q.p,this.r.i),d=c/2+this.r.k-a[0],c=c/2+this.r.l-a[1],g=this.F.e,f=b;null!=f?(f[0]=B(g,0),f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=B(g,1),f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=B(g,2),f[11]=0,f[12]=g.d[0]+d,f[13]=g.d[1]+c,f[14]=g.d[2],f[15]=1):(f=v(),x(q.ha(g.d[0]+d,g.d[1]+c,g.d[2]),q.Ga(B(g,0),B(g,1),B(g,2)),f));return f}; Ra.prototype.size=function(){return this.J};q.Wb=oa; q.Xb=function(a,b,c){this.r=a;this.pa=b;this.oa=c;this.Pa=this.zb=this.Db=!1;this.va=function(){!0==this.Pa?null!=this.oa&&this.oa():!0==this.Db&&!0==this.zb&&null!=this.pa&&this.pa(this.r,new Ra(this.r,this.F,this.u))}.bind(this);this.u=new Image;this.u.onload=function(){this.zb=!0;this.va()}.bind(this);this.u.onerror=function(){this.Pa=!0;this.va()}.bind(this);this.u.crossOrigin="anonymous";this.u.src=ga(this.r);this.F=new H;this.mc=function(){this.Db=!0;this.va()}.bind(this);this.lc=function(){this.Pa= !0;this.va()}.bind(this);this.F.load(fa(this.r),this.mc,this.lc)};function y(a,b,c){this.i=null!=a?a:0;this.k=null!=b?b:0;this.l=null!=c?c:0}function C(a,b){var c=A(q.p,a.i),d=a.k+c/2,c=a.l+c/2;switch(b){case 0:return new y(a.i+1,a.k,a.l);case 1:return new y(a.i+1,d,a.l);case 2:return new y(a.i+1,a.k,c);case 3:return new y(a.i+1,d,c)}}y.prototype.parent=function(){var a=A(q.p,this.i),b=q.p.A;return new y(this.i-1,b.k+((this.k-b.k)/a&-2)*a,b.l+((this.l-b.l)/a&-2)*a)}; y.prototype.isEqual=function(a){return this.i==a.i&&this.k==a.k&&this.l==a.l};q.ma={B:[],s:[],M:[]}; q.Ua=function(a,b,c,d,g){if(null!=b&&""!=b){var f=b.split("?")[0].split("/").slice(0,-1).join("/")+"/",h=document.getElementById(a);if(null==h)null!=d&&d(!1,"div does not exist");else{var k=null,l=null,m=function(){null==k||null==l&&null!=c||(q.p=new ca(k,f),q.j=new ia(l),q.Sb=g,q.b=new Ea(h,q.nc),null!=d&&d(!0))}.bind(this);a=function(a){k=a;m()}.bind(this);var n=function(a){l=a;m()}.bind(this),p=function(a){null!=d&&d(!1,a+" config not found")}.bind(this);null!=c&&q.Cb(c,n,p.bind(this,"browser")); q.Cb(b,a,p.bind(this,"map"))}}};q.Zb=function(){var a=document.createElement("canvas");if(null==a)return!1;a.width=1024;a.height=768;if(null==a.getContext)return!1;var b=null;try{b=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(c){return!1}return b?!0:!1};q.cb=function(a){if(null!=q.b&&null!=q.b.h&&q.j.V!=a){if("manual"==a){var b=q.ec();b[0]>q.b.a[2]&&(q.b.a[2]=b[0]+100)}q.j.V=a;I(q.b);a=q.ma;a.B=[];a.M=[];a.s=[]}};q.dc=function(){return q.j.V}; q.Ia=function(a,b,c){null!=q.b&&(q.b.a=u([a,b,c]),I(q.b))};q.ka=function(){return u([q.b.a[0],q.b.a[1],q.b.a[2]])};q.Ha=function(a,b,c){null!=q.b&&(q.b.g=u([a,b,c]),I(q.b))};q.tb=function(){return q.b.g};q.Ic=function(a,b,c){if(null!=q.b&&null!=q.b.h){var d=q.b.h;d.sb=a;d.Ya=b;d.Qa=c;d.q=!0;I(q.b)}};q.Bc=function(){return[0,0,0]};q.Hc=function(){return[0,0,0]};q.Pc=function(){return[[0,0],[1,0],[0,1]]};q.a=[0,0];q.Gc=[0,0]; q.oc=function(){var a=0.5*Sa,b=0.5*Ta;if(null!=q.b){var c=q.ma,d=Pa(q.b)/800,a=a*d,b=b*d,g=q.Y(q.tb()[0]),d=[-Math.sin(g),Math.cos(g)],g=[Math.cos(g),Math.sin(g)];q.b.a[0]+=d[0]*b-g[0]*a;q.b.a[1]+=d[1]*b-g[1]*a;0<q.j.ba[0]&&c.B.push([d[0]*b-g[0]*a,d[1]*b-g[1]*a]);I(q.b)}};q.rotate=function(a,b,c){if(null!=q.b){var d=q.ma;null==c&&(c=0);q.b.g[0]+=0.3*-a;q.b.g[1]+=0.3*-b;q.b.g[2]+=0.3*c;0<q.j.ba[1]&&d.s.push([0.3*-a,0.3*-b,0.3*c]);q.b.La=!0;I(q.b)}}; q.zoom=function(a){if(null!=q.b){var b=q.ma;a=1+0.001*a;q.b.a[2]*=a;0<q.j.ba[2]&&b.M.push([a]);I(q.b)}};q.ec=function(){var a=q.b.a[0],b=q.b.a[1];if(null!=q.b)return q.ua(s([a,b]),q.b.H)}; q.nc=function(){if(null!=q.b){var a=q.ma,b=!1,c=q.j.ba[0],d=q.j.ba[1],g=q.j.ba[2];0<a.s.length&&0==a.B.length&&0==a.M.length&&(q.b.La=!0);for(var f=0;f<a.B.length;f++)a.B[f][0]*=c,a.B[f][1]*=c,q.b.a[0]+=a.B[f][0],q.b.a[1]+=a.B[f][1],0.01>Math.abs(a.B[f][0])+Math.abs(a.B[f][1])&&(a.B.splice(f,1),f--),b=!0;for(f=0;f<a.M.length;f++)a.M[f][0]+=(1-a.M[f][0])*(1-g),q.b.a[2]*=a.M[f][0],0.001>Math.abs(1-a.M[f][0])&&(a.M.splice(f,1),f--),b=!0;for(f=0;f<a.s.length;f++)a.s[f][0]*=d,a.s[f][1]*=d,a.s[f][2]*=d, q.b.g[0]+=a.s[f][0],q.b.g[1]+=a.s[f][1],q.b.g[2]+=a.s[f][2],0.01>Math.abs(a.s[f][0])+Math.abs(a.s[f][1])+Math.abs(a.s[f][2])&&(a.s.splice(f,1),f--),b=!0;!0==b&&I(q.b);null!=q.Sb&&q.Sb()}};function Ua(a,b){!1==a&&alert("Vadstena3D initialization failed. Reason: "+b)}var Va=!1,Wa=!1,Xa=!1,Ya=!1,Za=!1,$a=0,ab=0,Sa=0,Ta=0;function bb(a){var b=!1;a=a||window.event;a.which?b=3==a.which:a.button&&(b=2==a.button);!0==b?Ya=!0:Za=!0} function cb(a){var b=!1;a=a||window.event;a.which?b=3==a.which:a.button&&(b=2==a.button);!0==b?Ya=!1:Za=!1}function db(a){var b=a.clientX;a=a.clientY;Sa=b-$a;Ta=a-ab;$a=b;ab=a;!0==Za&&!0!=Va&&!0!=Wa&&!0!=Xa&&q.oc();!0!=Ya&&(!0!=Za||!0!=Va&&!0!=Wa&&!0!=Xa)||q.rotate(0.4*Sa,0.4*Ta)}function eb(a){a.preventDefault&&a.preventDefault();a.returnValue=!1;var b=0,b=a.wheelDelta,b=(a=a.detail)?b?b/a/40*(0<=a?1:-1):-a/3:b/120;!0==isNaN(b)&&(b=0);b=0>b?1:-1;"observer"==q.dc()?q.zoom(17.5*b):q.zoom(7*b)} function fb(a){"undefined"==typeof a&&(a=window.event);Va=a.altKey;Wa=a.ctrlKey;Xa=a.shiftKey}function gb(a){"undefined"==typeof a&&(a=window.event);if(a)switch(window.event?window.event.keyCode:a.which?a.which:a.charCode){case 49:q.cb("manual");break;case 50:q.cb("drone");break;case 51:q.cb("observer")}Va=a.altKey;Wa=a.ctrlKey;Xa=a.shiftKey} window.startDemo=function(){!1==q.Zb()?alert("Unfturtunately, Vadstena3D needs browser support for WebGL. Sorry."):(q.Ua("demo","./mapConfig.json",null,Ua),document.onmousedown=bb,document.oncontextmenu=function(){return!1},document.onmouseup=cb,document.onmousemove=db,window.addEventListener("DOMMouseScroll",eb,!0),window.addEventListener("mousewheel",eb,!0),document.onselectstart=function(){return!1},document.onkeyup=gb,document.onkeypress=gb,document.onkeydown=fb)};</script>
</head>
<body style = "padding: 0; margin: 0;" onload="startDemo()">
<div id="demo" style="width:100%; height:100%;"></div>
<div style="position:absolute;left:0px;bottom:0px; width:100%; height: 50px; background-color: rgba(0,0,0,0.85);">
<img style="padding-left:10px;padding-top:10px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMUAAAAeCAYAAACcwdocAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1NThDQTU2QTA2OTRFMzExQkVBNUJERDYzRjYwNzdDNiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCMEY0NzI2RTk0MDcxMUUzOEIyOEZBRjZCNkZDRTBFNyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCMEY0NzI2RDk0MDcxMUUzOEIyOEZBRjZCNkZDRTBFNyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjU2OENBNTZBMDY5NEUzMTFCRUE1QkRENjNGNjA3N0M2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU1OENBNTZBMDY5NEUzMTFCRUE1QkRENjNGNjA3N0M2Ii8+IDwvcmRmOkRlc2NyaXB0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">
</div>
</body>
</html>