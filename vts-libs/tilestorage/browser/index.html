<html>
<head>
<title>Vadstena Map Viewer</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<script type="text/javascript">var k,q={};window.Vadstena=q;window.Qb=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};glMatrixArrayType2=Array;function r(a){var b=new glMatrixArrayType2(2);a&&(b[0]=a[0],b[1]=a[1]);return b}function t(){return new glMatrixArrayType2(4)}function u(a){var b=new glMatrixArrayType2(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b} function w(a){var b=new glMatrixArrayType2(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b} function x(a,b){if(b&&a!=b)b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];else{var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],h=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=f;a[11]=a[14];a[12]=e;a[13]=g;a[14]=h}} function y(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],l=a[5],m=a[6],n=a[7],p=a[8],s=a[9],v=a[10],C=a[11],Q=a[12],R=a[13],S=a[14];a=a[15];var T=b[0],U=b[1],V=b[2],W=b[3],X=b[4],Y=b[5],Z=b[6],$=b[7],aa=b[8],ba=b[9],ca=b[10],da=b[11],ea=b[12],fa=b[13],ga=b[14];b=b[15];c[0]=T*d+U*h+V*p+W*Q;c[1]=T*e+U*l+V*s+W*R;c[2]=T*f+U*m+V*v+W*S;c[3]=T*g+U*n+V*C+W*a;c[4]=X*d+Y*h+Z*p+$*Q;c[5]=X*e+Y*l+Z*s+$*R;c[6]=X*f+Y*m+Z*v+$*S;c[7]=X*g+Y*n+Z*C+$*a;c[8]=aa*d+ba*h+ca*p+da*Q;c[9]=aa*e+ba*l+ca*s+da*R;c[10]= aa*f+ba*m+ca*v+da*S;c[11]=aa*g+ba*n+ca*C+da*a;c[12]=ea*d+fa*h+ga*p+b*Q;c[13]=ea*e+fa*l+ga*s+b*R;c[14]=ea*f+fa*m+ga*v+b*S;c[15]=ea*g+fa*n+ga*C+b*a}function ha(a,b,c){c||(c=b);var d=b[0],e=b[1];b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14]} quat4={create:function(a){var b=new glMatrixArrayType2(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},Fc:function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a==b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a;b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b},inverse:function(a,b){if(!b||a==b)return a[0]*=1,a[1]*=1,a[2]*=1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b},length:function(a){var b= a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);if(0==g)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;g=1/g;b[0]=c*g;b[1]=d*g;b[2]=e*g;b[3]=f*g;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2];a=a[3];var g=b[0],h=b[1],l=b[2];b=b[3];c[0]=d*b+a*g+e*l-f*h;c[1]=e*b+a*h+f*g-d*l;c[2]=f*b+a*l+d*h-e*g;c[3]=a*b-d*g-e*h-f*l;return c},Ic:function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2];b=a[0]; var g=a[1],h=a[2];a=a[3];var l=a*d+g*f-h*e,m=a*e+h*d-b*f,n=a*f+b*e-g*d,d=-b*d-g*e-h*f;c[0]=l*a+d*-b+m*-h-n*-g;c[1]=m*a+d*-g+n*-b-l*-h;c[2]=n*a+d*-h+l*-g-m*-b;return c},Mc:function(a,b){b||(b=new glMatrixArrayType2(9));var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,l=e+e,m=c*g,n=c*h,c=c*l,p=d*h,d=d*l,e=e*l,g=f*g,h=f*h,f=f*l;b[0]=1-(p+e);b[1]=n-f;b[2]=c+h;b[3]=n+f;b[4]=1-(m+e);b[5]=d-g;b[6]=c-h;b[7]=d+g;b[8]=1-(m+p);return b},Nc:function(a,b){b||(b=w());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,l=e+ e,m=c*g,n=c*h,c=c*l,p=d*h,d=d*l,e=e*l,g=f*g,h=f*h,f=f*l;b[0]=1-(p+e);b[1]=n-f;b[2]=c+h;b[3]=0;b[4]=n+f;b[5]=1-(m+e);b[6]=d-g;b[7]=0;b[8]=c-h;b[9]=d+g;b[10]=1-(m+p);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},Kc:function(a,b,c,d){d||(d=a);var e=c;0>a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]&&(e=-1*c);d[0]=1-c*a[0]+e*b[0];d[1]=1-c*a[1]+e*b[1];d[2]=1-c*a[2]+e*b[2];d[3]=1-c*a[3]+e*b[3];return d},Lc:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}}; q.ec=function(a,b,c,d,e,f){var g=b-a,h=d-c,l=f-e;a=w([2*e/g,0,(b+a)/g,0,0,2*e/h,(d+c)/h,0,0,0,-(f+e)/l,-2*f*e/l,0,0,-1,0]);x(a);return a};q.qc=function(a,b,c,d){a=c*Math.tan(a*Math.PI/360);b*=a;return q.ec(-b,b,-a,a,c,d)};q.xa=function(a,b){var c=Math.cos(b),d=Math.sin(b);switch(a){case 0:c=w([1,0,0,0,0,c,-d,0,0,d,c,0,0,0,0,1]);break;case 1:c=w([c,0,-d,0,0,1,0,0,d,0,c,0,0,0,0,1]);break;default:c=w([c,-d,0,0,d,c,0,0,0,0,1,0,0,0,0,1])}x(c);return c}; q.Pa=function(a,b,c){a=w([a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1]);x(a);return a};q.wc=function(a){return q.Pa(a,a,a)};q.ja=function(a,b,c){a=w([1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1]);x(a);return a};q.Oc=function(a){return q.ja(a[0],a[1],0)};q.Pc=function(a){return q.ja(a[0],a[1],a[2])};q.ca=function(a,b,c){a<b?a=b:a>c&&(a=c);return a};q.oa=function(a){return a*Math.PI/180}; q.Nb=function(a){var b=7;if(0>a)return a=-a+"",b--,a.length>=b?"-"+a:"-"+(Array(b-a.length+1).join("0")+a);a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a};q.yc=function(a,b){return a.replace(/\{([_$a-zA-Z0-9][_$a-zA-Z0-9]*)\}/g,function(a,d){return d in b?b[d]:a})}; q.Eb=function(a,b,c){var d=new XMLHttpRequest;d.onload=function(){var a=d.response;try{var f=eval("("+a+")")}catch(g){null!=c&&c();return}null!=b&&b(f)}.bind(this);d.onerror=function(){null!=c&&c()}.bind(this);d.open("GET",a,!0);d.send("")}; q.Db=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){switch(d.readyState){case 0:case 1:case 2:case 3:break;case 4:if(404==d.status){null!=c&&c();break}var a=new DataView(d.response);null!=b&&b(a);break;default:null!=c&&c()}}.bind(this);d.onerror=function(){null!=c&&c()}.bind(this);d.open("GET",a,!0);d.responseType="arraybuffer";d.send("")};window.performance=window.performance||{}; performance.now=performance.now||performance.Gc||performance.Hc||performance.Jc||performance.webkitNow||function(){return(new Date).getTime()}; function ia(a,b,c){this.G=new z(a);this.Hb=this.Ib=this.vb=0;this.Fa=[];this.rb=u();this.ac=c;this.Ub=this.Gb=this.Jb="";null!=b.foat&&(this.G.j=b.foat[0],this.G.n=b.foat[1],this.G.o=b.foat[2],this.vb=b.foat[3]);null!=b.meta&&(this.Ib=b.meta[0],this.Hb=b.meta[1]);this.Jb=b.metaTemplate;this.Gb=b.meshTemplate;this.Ub=b.textureTemplate;if(null!=b.defaultPosition&&null!=b.defaultOrientation)for(a=0;3>a;a++)this.Fa[a]=b.defaultPosition[a],this.rb[a]=b.defaultOrientation[a]} function A(a,b){return a.vb>>b-a.G.j}function ja(a,b){return ka(a,a.Jb,b)}function la(a,b){return ka(a,a.Gb,b)}function ma(a,b){return ka(a,a.Ub,b)}function ka(a,b,c){b=q.yc(b,{lod:c.j,easting:q.Nb(c.n),northing:q.Nb(c.o)});return a.ac+b}function na(a,b,c){var d=A(a,12),e=Math.round((b[0]-a.G.n)/d),f=Math.round((b[1]-a.G.o)/d);return null!=c?(c[0]=a.G.n+e*d,c[1]=a.G.o+f*d,c[2]=b[2],c):u([a.G.n+e*d,a.G.o+f*d,b[2]])} function oa(a){this.Va=1073741824;this.yb=402653184;this.ta=4;this.ob=45;this.Wa=6E5;this.zb=8;this.Ab=32;this.ia="./skydome.jpg";this.da=[0.8,0.8,0.8];this.la="observer";if(null!=a&&(null!=a.cacheSize&&(this.Va=a.cacheSize),null!=a.gpuCacheSize&&(this.yb=a.gpuCacheSize),null!=a.numThreads&&(this.ta=a.numThreads),null!=a.cameraFOV&&(this.ob=a.cameraFOV),null!=a.cameraVisibility&&(this.Wa=a.cameraVisibility),null!=a.gridEmbeddingFactor&&(this.zb=a.gridEmbeddingFactor),null!=a.gridMinTileSize&&(this.Ab= a.gridMinTileSize),null!=a.skydomeTexture&&(this.ia=a.skydomeTexture),null!=a.controlMode&&(this.la=a.controlMode),null!=a.controlInertia))for(var b=0;3>b;b++)this.da[b]=a.controlInertia[b]} function pa(a,b,c,d,e,f){this.e=[];this.g=[];this.e[0]=null!=a?a:Number.POSITIVE_INFINITY;this.e[1]=null!=b?b:Number.POSITIVE_INFINITY;this.e[2]=null!=c?c:Number.POSITIVE_INFINITY;this.g[0]=null!=d?d:Number.NEGATIVE_INFINITY;this.g[1]=null!=e?e:Number.NEGATIVE_INFINITY;this.g[2]=null!=f?f:Number.NEGATIVE_INFINITY}function B(a,b){return a.g[b]-a.e[b]}function qa(a){this.ga=[];this.Ha=null!=a?a:Number.MAX_VALUE;this.aa=0;this.J=this.R=null}k=qa.prototype; k.log=function(){for(var a=0,b=this.J;null!=b.V&&!(b=this.ga[b.V][3],a++,10<a););this.ga.forEach(function(){})};k.find=function(a){a=this.hash(a);a=this.ga[a];if(null!=a){if(this.J!=a){null!=a.W&&(a.W.V=a.V);null!=a.V&&(a.V.W=a.W);this.R==a&&(this.R=a.W);var b=this.J;this.J=a;this.J.V=b;this.J.W=null;b.W=this.J}return a.Ga}return null};k.contains=function(a){return null!=this.ga[this.hash(a)]}; k.clear=function(){for(var a=this.J;null!=a;)null!=a.Ga&&a.Ga.t(),a=a.V;this.ga=[];this.J=this.R=null;this.aa=0};function ra(a,b,c,d){b=a.hash(b);c={fc:b,Ga:c,bc:d,W:null,V:a.J};null!=a.J&&(a.J.W=c);a.J=c;null==a.R&&(a.R=c);a.ga[b]=c;a.aa+=d;sa(a)}function sa(a){for(;a.aa>a.Ha;){var b=a.R;if(null!=b)a.R=a.R.W,null!=a.R&&(a.R.V=null),a.ga[b.fc]=null,a.aa-=b.bc,b.Ga.t();else break}}k.hash=function(a){return""+Math.round(a.j)+"."+Math.round(a.n)+"."+Math.round(a.o)}; function ta(a,b,c,d,e){null==d&&(d=1);this.a=a;this.ta=d;this.Ta=0;this.B=new qa(b);this.ha=[];this.Ja=[];this.fa=[];this.Kb=c;this.sb=e}k=ta.prototype;k.get=function(a){var b=this.B.find(a);null==b&&this.fb(a);return b};k.contains=function(a){return this.B.contains(a)};k.trim=function(a){var b=this.B.Ha,c=this.B;c.Ha=a;sa(c);a=this.B;a.Ha=b;sa(a)};k.reset=function(){this.B.clear()};k.size=function(){return this.B.aa}; k.fb=function(a){var b=this.B.hash(a),c=this.fa.indexOf(b);-1==c&&(c=this.ha.indexOf(b),-1!=c&&(this.ha.splice(c,1),this.Ja.splice(c,1)),this.ha.unshift(b),this.Ja.unshift(a),20<this.ha.length&&(this.ha.pop(),this.Ja.pop()))}; k.update=function(){if(0<this.ha.length&&this.Ta<this.ta){var a=this.ha.shift(),b=this.Ja.shift();if(-1==this.fa.indexOf(a)){this.fa.push(a);this.Ta++;var a=function(a,b){this.fa.splice(this.fa.indexOf(this.B.hash(a)),1);this.Ta--;ra(this.B,a,b,b.size());null!=this.Kb&&this.Kb(a)}.bind(this),c=function(a){this.fa.splice(this.fa.indexOf(this.B.hash(a)),1);this.Ta--}.bind(this);null!=this.sb&&new this.sb(this.a,b,a,c)}}}; function ua(a,b,c){this.c=u([0,0,0]);this.h=u([0,0,0]);this.nb=1;this.wb=a;this.eb=b;this.pa=c;this.U=w();this.La=w();this.Ia=w();this.T=[t(),t(),t(),t(),t(),t()];this.Rb=t();this.v=!0}k=ua.prototype;k.za=function(a){this.c=a;this.v=!0};k.ya=function(a){this.h=a;this.v=!0};k.ma=function(){return u(this.c)};k.Za=function(){return u(this.h)};function va(a){a.v&&a.update();return a.U}function wa(a){a.v&&a.update();return a.La} k.update=function(){this.U=w();y(q.xa(1,q.oa(-this.h[2])),q.xa(0,q.oa(-this.h[1]-90)),this.U);y(this.U,q.xa(2,q.oa(-this.h[0])),this.U);y(this.U,q.ja(-this.c[0],-this.c[1],-this.c[2]),this.U);this.La=q.qc(this.wb,this.nb,this.eb,this.pa);this.Ia=w();y(this.La,this.U,this.Ia);this.T[0]=[0,0,1,1];this.T[1]=[0,0,-1,1];this.T[2]=[1,0,0,1];this.T[3]=[-1,0,0,1];this.T[4]=[0,1,0,1];this.T[5]=[0,-1,0,1];var a=w();x(this.Ia,a);for(var b=0;6>b;b++){var c=this.T,d=b,e=a,f=this.T[b],g=void 0,g=f,h=f[0],l=f[1], m=f[2],f=f[3];g[0]=e[0]*h+e[4]*l+e[8]*m+e[12]*f;g[1]=e[1]*h+e[5]*l+e[9]*m+e[13]*f;g[2]=e[2]*h+e[6]*l+e[10]*m+e[14]*f;g[3]=e[3]*h+e[7]*l+e[11]*m+e[15]*f;c[d]=g}this.v=!1}; q.Tb=function(a,b,c,d,e,f){var g=e.get(c);if(!g)return[d,c.j>=f];var h=A(a.s,c.j);d=(b[0]-c.n)/h;h=(b[1]-c.o)/h;d=q.ca(d,0,0.9999);var h=q.ca(h,0,0.9999),l=q.ba,m=d*(l-1),n=h*(l-1),p=Math.floor(m),s=Math.floor(n),v=g.L[s*l+p],C=g.L[(s+1)*l+p],m=m-p,v=v+(g.L[s*l+p+1]-v)*m,l=v+(C+(g.L[(s+1)*l+p+1]-C)*m-v)*(n-s),n=0,n=0.5>h?0.5>d?0:1:0.5>d?2:3;return!(g.Z&1<<n)||c.j>=f?[l,!0]:q.Tb(a,b,D(c,n),l,e)};q.Da=function(a,b,c){var d;null==d&&(d=Number.MAX_VALUE);return q.Tb(a,b,a.s.G,0,c,d)}; function E(a,b){this.F=a;this.u=null;this.D=b;this.qb=null}function xa(a){a.u=document.createElement("canvas");if(null!=a.u&&(a.u.width=a.D[0],a.u.height=a.D[1],a.u.style.display="block",null!=a.u.getContext)){try{a.d=a.u.getContext("webgl")||a.u.getContext("experimental-webgl")}catch(b){}a.d&&(a.F.appendChild(a.u),a.d.mb=a.u.width,a.d.lb=a.u.height,a.d.clearColor(0,0,0,1),a.d.enable(a.d.DEPTH_TEST),a.d.viewport(0,0,a.d.mb,a.d.lb),a.d.clear(a.d.COLOR_BUFFER_BIT|a.d.DEPTH_BUFFER_BIT))}} E.prototype.resize=function(a){this.D=a;null!=this.u&&(this.u.width=this.D[0],this.u.height=this.D[1]);null!=this.d&&(this.d.mb=this.u.width,this.d.lb=this.u.height)};E.prototype.clear=function(){this.d.viewport(0,0,this.d.mb,this.d.lb);this.d.clear(this.d.DEPTH_BUFFER_BIT);this.d.enable(this.d.CULL_FACE)};E.prototype.useProgram=function(a,b,c){this.qb!=a&&(this.d.useProgram(a.S),this.qb=a,ya(a),b=a.getAttribute(b),a=a.getAttribute(c),this.d.enableVertexAttribArray(b),this.d.enableVertexAttribArray(a))}; E.prototype.bindTexture=function(a){!1!=a.cb&&(this.d.activeTexture(this.d.TEXTURE0),this.d.bindTexture(this.d.TEXTURE_2D,a.P))};q.Ec=function(){return!0}; function F(a,b){this.f=b.f;var c=this.d=a.d;null!=c&&(this.ka=this.Y=null,this.Y=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,this.Y),c.bufferData(c.ARRAY_BUFFER,new Float32Array(b.m),c.STATIC_DRAW),this.Y.ab=3,this.Y.gb=b.m.length/3,this.ka=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,this.ka),c.bufferData(c.ARRAY_BUFFER,new Float32Array(b.p),c.STATIC_DRAW),this.ka.ab=2,this.ka.gb=b.p.length/2,this.O=4*(b.m.length+b.p.length)+32,this.hb=this.Y.gb/3)} F.prototype.t=function(){this.d.deleteBuffer(this.Y);this.d.deleteBuffer(this.ka)};function za(a,b){var c=a.d;if(null!=c){var d=b.getAttribute("aPosition"),e=b.getAttribute("aTexCoord");c.bindBuffer(c.ARRAY_BUFFER,a.Y);c.vertexAttribPointer(d,a.Y.ab,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,a.ka);c.vertexAttribPointer(e,a.ka.ab,c.FLOAT,!1,0,0);c.drawArrays(c.TRIANGLES,0,a.Y.gb)}}F.prototype.size=function(){return this.O}; function G(a,b,c){this.d=a.d;this.S=null;this.jb=[];this.Ua=[];this.createProgram(b,c)}G.prototype.createShader=function(a,b){if(!a)return null;var c=this.d;if(null!=c){var d;d=!0!=b?c.createShader(c.FRAGMENT_SHADER):c.createShader(c.VERTEX_SHADER);c.shaderSource(d,a);c.compileShader(d);return c.getShaderParameter(d,c.COMPILE_STATUS)?d:(alert("An error occurred compiling the shaders: "+c.getShaderInfoLog(d)),null)}}; G.prototype.createProgram=function(a,b){var c=this.d;if(null!=c){var d=this.createShader(a,!0),e=this.createShader(b,!1),f=c.createProgram();c.attachShader(f,d);c.attachShader(f,e);c.linkProgram(f);c.getProgramParameter(f,c.LINK_STATUS)||alert("Unable to initialize the shader program.");c.useProgram(f);this.S=f}};function ya(a){var b=a.d;null!=b&&null!=a.S&&(a=a.getUniform("uSampler"),null!=a&&b.uniform1i(a,0))} function H(a,b,c){var d=a.d;null!=d&&null!=a.S&&(a=a.getUniform(b),null!=a&&d.uniformMatrix4fv(a,!1,c))}function Aa(a,b,c){var d=a.d;null!=d&&null!=a.S&&(a=a.getUniform(b),null!=a&&d.uniform1f(a,c))}G.prototype.getAttribute=function(a){var b=this.d;if(null!=b&&null!=this.S)return null==this.Ua[a]?(b=b.getAttribLocation(this.S,a),this.Ua[a]=b):this.Ua[a]}; G.prototype.getUniform=function(a){var b=this.d;if(null!=b&&null!=this.S)return null==this.jb[a]?(b=b.getUniformLocation(this.S,a),this.jb[a]=b):this.jb[a]};q.Ac="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMVP;\nvarying vec2 vTexCoord;\nvoid main(){ \ngl_Position = uMVP * vec4(aPosition, 1.0);\nvTexCoord = aTexCoord;\n}";q.zc="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nconst vec4 gray = vec4(0.125, 0.125, 0.125, 1.0);\nvoid main() {\nfloat fade = smoothstep(0.51, 0.55, vTexCoord.t);\ngl_FragColor = mix(texture2D(uSampler, vTexCoord), gray, fade);\n}"; q.ic="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nuniform mat4 uGridMat;\nuniform float uGridStep1, uGridStep2;\nconst int HMSize = 5;\nconst float HMSize1 = float(HMSize-1);\nuniform float uHeight[HMSize*HMSize];\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nfloat round(float x) { return floor(x + 0.5); }\nvoid main() {\nvec3 pos = aPosition;\nfloat z = uHeight[int(round(pos.y*HMSize1)*float(HMSize) + round(pos.x*HMSize1))];\nvec4 camSpacePos = uMV * vec4(pos.xy, z, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvec4 gridCoord = uGridMat * vec4(pos, 1.0);\nvTexCoord1 = aTexCoord;\nvTexCoord1 = gridCoord.xy * vec2(uGridStep1);\nvTexCoord2 = gridCoord.xy * vec2(uGridStep2);\n}"; q.gc="precision mediump float;\nuniform sampler2D uSampler;\nuniform float uGridBlend;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nconst vec4 fogColor = vec4(1, 1, 1, 1);\nvoid main() {\nvec4 gridColor = mix(texture2D(uSampler, vTexCoord1), texture2D(uSampler, vTexCoord2), uGridBlend);\ngl_FragColor = mix(fogColor, gridColor, vFogFactor);\n}";q.Cc="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvTexCoord = aTexCoord;\n}"; q.Bc="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nconst vec4 fogColor = vec4(1, 1, 1, 1);\nvoid main() {\ngl_FragColor = mix(fogColor, texture2D(uSampler, vTexCoord), vFogFactor);\n}";function I(a,b,c){this.d=a.d;this.P=null;this.O=0;this.C=null;this.cb=!1;this.a=c;null!=b&&this.load(b)}I.prototype.t=function(){this.d.deleteTexture(this.P)};I.prototype.size=function(){return this.O}; function Ba(a,b,c){var d=a.d;a.P=d.createTexture();d.bindTexture(d.TEXTURE_2D,a.P);c=!0==c?d.REPEAT:d.CLAMP_TO_EDGE;d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,c);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,c);c=!1;switch("linear"){case "linear":d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);break;case "trilinear":d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER, d.LINEAR);c=!0;break;default:d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST)}d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b);!0==c&&d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null);a.O=b.naturalWidth*b.naturalHeight*4;a.cb=!0} I.prototype.load=function(a,b,c){this.C=new Image;this.C.crossOrigin="anonymous";this.C.onload=function(){if(null==this.a||!0!=this.a.k)Ba(this,this.C,!1),this.C=null}.bind(this);this.C.onerror=function(){null!=this.a&&!0==this.a.k||null==c||c()}.bind(this);this.C.src=a};function Ca(a,b){this.q=a;this.H=new F(a,b.H);this.P=new I(a);Ba(this.P,b.C)}Ca.prototype.t=function(){this.H.t();this.P.t()};Ca.prototype.size=function(){return this.H.size()+this.P.size()}; function Da(a,b){this.q=a;this.B=new qa(b)}Da.prototype.get=function(a,b){var c=this.B.find(a);if(c)return c;c=new Ca(this.q,b);ra(this.B,a,c,c.size());return c};Da.prototype.size=function(){return this.B.aa};Da.prototype.reset=function(){return this.B.clear()};function J(){this.m=[];this.p=[];this.f=new pa}J.prototype.t=function(){this.m=[];this.p=[];this.f=null}; J.prototype.load=function(a,b,c){q.Db(a,function(a){for(var c=0,f=1/65535,g="",h=0;8>h;h++)g+=String.fromCharCode(a.getUint8(c,!0)),c+=1;if("BIN.MESH"==g&&(h=a.getUint32(c,!0),c+=4,!(1<h))){for(h=0;3>h;h++)this.f.e[h]=a.getFloat64(c,!0),c+=8;for(h=0;3>h;h++)this.f.g[h]=a.getFloat64(c,!0),c+=8;for(var g=a.getUint16(c,!0),c=c+2,l=Array(3*g),m=0;m<g;m++)h=3*m,l[h]=a.getUint16(c,!0),c+=2,l[h+1]=a.getUint16(c,!0),c+=2,l[h+2]=a.getUint16(c,!0),c+=2;for(var g=a.getUint16(c,!0),c=c+2,n=Array(2*g),m=0;m<g;m++)h= 2*m,n[h]=a.getUint16(c,!0),c+=2,n[h+1]=65535-a.getUint16(c,!0),c+=2;g=a.getUint16(c,!0);c+=2;this.m=Array(9*g);this.p=Array(6*g);for(m=0;m<g;m++){for(h=0;3>h;h++){var p=3*a.getUint16(c,!0),c=c+2,s=9*m+3*h;this.m[s]=l[p]*f;this.m[s+1]=l[p+1]*f;this.m[s+2]=l[p+2]*f}for(h=0;3>h;h++)p=2*a.getUint16(c,!0),c+=2,s=6*m+2*h,this.p[s]=n[p]*f,this.p[s+1]=n[p+1]*f}this.O=8*(this.m.length+this.p.length)+56;null!=b&&b()}}.bind(this),function(){null!=c&&c()}.bind(this))};J.prototype.size=function(){return this.O}; q.Ra=function(a,b){b*=Math.PI;a=2*a*Math.PI;return u([Math.cos(a)*Math.sin(b)*0.5+0.5,Math.sin(a)*Math.sin(b)*0.5+0.5,0.5*Math.cos(b)+0.5])};q.ba=5; function Ea(a,b,c){this.a=a;this.f=new pa;this.Ka=[];this.L=[];this.Z=0;this.Ba=[];for(a=0;2>a;a++)this.Ka[a]=[];var d=c.ea.getInt16(c.r,!0);c.r+=2;a=c.ea.getInt16(c.r,!0);c.r+=2;this.f.e[0]=b.n;this.f.e[1]=b.o;this.f.e[2]=d;d=A(this.a.s,b.j);this.f.g[0]=b.n+d;this.f.g[1]=b.o+d;this.f.g[2]=a;for(a=0;2>a;a++)for(b=0;2>b;b++)this.Ka[a][b]=c.ea.getFloat32(c.r,!0),c.r+=4;a=0;for(b=q.ba*q.ba;a<b;a++)this.L[a]=c.ea.getInt16(c.r,!0),c.r+=2;for(a=0;4>a;a++)this.Ba[a]=null;this.Z=0} Ea.prototype.qa=function(a,b){var c=b;null!=c?(c[0]=B(this.f,0),c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=B(this.f,1),c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=this.f.e[0]-a[0],c[13]=this.f.e[1]-a[1],c[14]=0,c[15]=1):(c=w(),y(q.ja(this.f.e[0]-a[0],this.f.e[1]-a[1],0),q.Pa(B(this.f,0),B(this.f,1),1),c));return c};Ea.prototype.size=function(){for(var a=308,b=0;4>b;b++)null!=this.Ba[b]&&(a+=this.Ba[b].size());return a}; function Fa(a,b,c){this.w=b;this.a=a;a="";for(var d=0;8>d;d++)a+=String.fromCharCode(c.ea.getUint8(c.r,!0)),c.r+=1;"METATILE"==a&&(a=c.ea.getUint32(c.r,!0),c.r+=4,1<a||(this.Vb=Ga(this,b,c)))}Fa.prototype.t=function(){};function Ga(a,b,c){var d=new Ea(a.a,b,c),e=c.ea.getUint8(c.r,!0);c.r+=1;for(var f=0;4>f;f++)e&1<<f+4&&(d.Ba[f]=Ga(a,D(b,f),c));d.Z=e&15;return d}Fa.prototype.size=function(){return this.Vb.size()}; q.Yb=function(a,b,c,d){this.a=a;this.w=b;this.va=c;this.ua=d;this.mc=function(b){!0!=this.a.k&&null!=this.va&&(b=new Fa(a,this.w,{ea:b,r:0}),this.va(this.w,b))}.bind(this);this.lc=function(){!0!=this.a.k&&null!=this.ua&&this.ua(this.w)}.bind(this);q.Db(ja(this.a.s,this.w),this.mc,this.lc)}; function Ha(a,b,c,d,e){this.a=a;this.I=new ta(a,b,c,d,e);this.contains=this.I.contains.bind(this.I);this.trim=this.I.trim.bind(this.I);this.reset=this.I.reset.bind(this.I);this.fb=this.I.fb.bind(this.I);this.update=this.I.update.bind(this.I);this.size=this.I.size.bind(this.I)} Ha.prototype.get=function(a){for(var b=a,c=this.a.s;Math.abs(b.j-c.Ib)%c.Hb&&b.j>c.G.j;)b=b.parent();if(b=this.I.get(b)){for(var c=new z(b.a,b.w.j,b.w.n,b.w.o),d=b.Vb;c.j<a.j;){var e=A(b.a.s,c.j),f=c.n+e/2,e=c.o+e/2,g=0;Math.round(a.n)>=Math.round(f)&&(g|=1,c.n=f);Math.round(a.o)>=Math.round(e)&&(g|=2,c.o=e);c.j++;(d=d.Ba[g])||console.log("Missing tile metadata")}!c.isEqual(a)&&console.log("Metatile inconsistency");a=d}else a=null;return a};q.vc=1.1; function Ia(a,b,c){this.a=a;this.wa=this.N=this.na=null;this.F=b;this.Mb=c;this.k=!1;this.D=[b.clientWidth,b.clientHeight];this.ib=!1;this.v=this.Bb=!0;this.kc=1;this.q=new E(b,this.D);this.i=new ua(this.a.l.ob,20,this.a.l.Wa);this.c=[this.a.s.Fa[0],this.a.s.Fa[1],this.a.s.Fa[2]];this.h=u(this.a.s.rb);this.M=new Ha(this.a,Number.MAX_VALUE,function(){this.v=!0}.bind(this),this.a.l.ta,q.Yb);this.X=new q.Zb(this.a,Number.MAX_VALUE,function(){this.v=!0}.bind(this),this.a.l.ta,q.$b);this.$a=new Da(this.q, this.a.l.yb);this.ia=this.Aa=this.sa=this.ra=null;this.hc=!1;this.Xb=!0;this.Sb=document.getElementById("renderStats");this.Ma=this.Pb=this.$=this.Na=this.Oa=this.Sa=this.Ca=0;this.bb=null;this.Ya=0;this.ub=w();this.tb=w();this.cc=u();this.dc=w();this.rc=w();this.Wb=w();this.uc=u();this.tc=[[3,1,2,0],[3,2,1,0],[2,3,0,1],[2,0,3,1],[0,2,1,3],[0,1,2,3],[1,0,3,2],[1,3,0,2]];window.addEventListener("resize",this.Lb.bind(this));xa(this.q);this.na=new G(this.q,q.Cc,q.Bc);this.N=new G(this.q,q.ic,q.gc);this.wa= new G(this.q,q.Ac,q.zc);Ja(this);Ka(this);La(this,this.D[0],this.D[1]);window.Qb(this.update.bind(this))}Ia.prototype.Lb=function(){!0!=this.k&&La(this,this.F.clientWidth,this.F.clientHeight)};Ia.prototype.t=function(){!0!=this.k&&(this.k=!0,this.M.reset(),this.X.reset(),this.$a.reset(),null!=this.ra&&this.ra.t(),null!=this.sa&&this.sa.t(),null!=this.Aa&&this.Aa.t(),null!=this.ia&&this.ia.t(),this.F.removeChild(this.q.u))}; function Ja(a){var b=new J,c=q.ba;c--;for(var d=0;d<c;d++)for(var e=0;e<c;e++){var f=e/c,g=(e+1)/c,h=d/c,l=(d+1)/c;b.m.push(f,h,0);b.m.push(g,h,0);b.m.push(g,l,0);b.p.push(f,h);b.p.push(g,h);b.p.push(g,l);b.m.push(g,l,0);b.m.push(f,l,0);b.m.push(f,h,0);b.p.push(g,l);b.p.push(f,l);b.p.push(f,h)}b.f.e[0]=b.f.e[1]=b.f.e[2]=0;b.f.g[0]=b.f.g[1]=b.f.g[2]=1;b.O=8*(b.m.length+b.p.length)+56;a.ra=new F(a.q,b);b=new Uint8Array(16384);for(c=0;64>c;c++)for(d=0;64>d;d++)e=4*(64*c+d),1>c||63<=c||1>d||63<=d?(b[e]= 255,b[e+1]=255,b[e+2]=255):(b[e]=32,b[e+1]=32,b[e+2]=32),b[e+3]=255;a.sa=new I(a.q);a=a.sa;d=!0;c=a.d;a.P=c.createTexture();c.bindTexture(c.TEXTURE_2D,a.P);d=!0==d?c.REPEAT:c.CLAMP_TO_EDGE;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,d);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,d);d=!1;switch("trilinear"){case "linear":c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);break;case "trilinear":c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER, c.LINEAR_MIPMAP_LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);d=!0;break;default:c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST)}c.pixelStorei(c.UNPACK_ALIGNMENT,1);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,64,64,0,c.RGBA,c.UNSIGNED_BYTE,b);!0==d&&c.generateMipmap(c.TEXTURE_2D);c.bindTexture(c.TEXTURE_2D,null);a.O=16384;a.cb=!0} function Ka(a){for(var b=new J,c=0;32>c;c++)for(var d=0;64>d;d++){var e=b,f=d/64,g=c/32,h=(d+1)/64,l=(c+1)/32,m=u(q.Ra(f,g)),n=r([f,g]),p=u(q.Ra(f,l)),f=r([f,l]),s=u(q.Ra(h,g)),g=r([h,g]),v=u(q.Ra(h,l)),h=r([h,l]);e.m.push(p[0],p[1],p[2]);e.m.push(m[0],m[1],m[2]);e.m.push(s[0],s[1],s[2]);e.p.push(f[0],f[1]);e.p.push(n[0],n[1]);e.p.push(g[0],g[1]);e.m.push(s[0],s[1],s[2]);e.m.push(v[0],v[1],v[2]);e.m.push(p[0],p[1],p[2]);e.p.push(g[0],g[1]);e.p.push(h[0],h[1]);e.p.push(f[0],f[1]);e.O=8*(e.m.length+ e.p.length)+56}b.f.e[0]=b.f.e[1]=b.f.e[2]=0;b.f.g[0]=b.f.g[1]=b.f.g[2]=1;a.Aa=new F(a.q,b);a.ia=new I(a.q,a.a.l.ia,a.a)}function La(a,b,c){var d=a.i;d.nb=b/c;d.v=!0;a.D=[b,c];a.q.resize(a.D);Ma(a)}function Na(a,b){var c=Math.log(0.05)/(10*a.a.l.Wa*(Math.max(5,-a.h[1])/90)),c=c*(1- -a.h[0]/90);Aa(b,"uFogDensity",c)} function Oa(a,b,c,d){if(c&&!a.hc)d=a.$a.get(b,c),a.q.useProgram(a.na,"aPosition","aTexCoord"),b=a.ub,y(va(a.i),c.qa(a.c,a.dc),b),c=wa(a.i),H(a.na,"uMV",b),H(a.na,"uProj",c),Na(a,a.na),a.q.bindTexture(d.P),za(d.H,a.na),a.Oa++,a.$+=d.H.hb;else{a.q.useProgram(a.N,"aPosition","aTexCoord");b=a.ub;y(va(a.i),d.qa(a.c,a.tb),b);H(a.N,"uMV",b);H(a.N,"uProj",wa(a.i));c=a.tb;d.qa(na(a.a.s,a.c,a.cc),c);H(a.N,"uGridMat",c);Na(a,a.N);c=a.a.l.zb;b=a.a.l.Ab;var e=q.ba,e=Math.log(a.i.c[2]-0.25*(d.L[0]+d.L[e-1]+d.L[(e- 1)*e]+d.L[(e-1)*e+e-1])+20)/Math.log(c),f=Math.pow(c,Math.ceil(e)),g=e-Math.floor(e);Aa(a.N,"uGridStep1",b/Math.pow(c,Math.floor(e)));Aa(a.N,"uGridStep2",b/f);Aa(a.N,"uGridBlend",g);c=a.N;d=d.L;b=c.d;null!=b&&null!=c.S&&(c=c.getUniform("uHeight"),null!=c&&b.uniform1fv(c,d));a.q.bindTexture(a.sa);za(a.ra,a.N);a.Na++;a.$+=a.ra.hb}} function Pa(a,b){var c=a.M.get(b),d;if(!(d=!c)){d=a.i;var e=c.f,f=a.c;a:{e=new pa(e.e[0]-f[0],e.e[1]-f[1],e.e[2],e.g[0]-f[0],e.g[1]-f[1],e.g[2]);d.v&&d.update();e=[[e.e[0],e.e[1],e.e[2],1],[e.e[0],e.e[1],e.g[2],1],[e.e[0],e.g[1],e.e[2],1],[e.e[0],e.g[1],e.g[2],1],[e.g[0],e.e[1],e.e[2],1],[e.g[0],e.e[1],e.g[2],1],[e.g[0],e.g[1],e.e[2],1],[e.g[0],e.g[1],e.g[2],1]];for(f=0;6>f;f++){for(var g=!0,h=0;8>h;h++){var l=d.T[f],m=e[h];if(0<=l[0]*m[0]+l[1]*m[1]+l[2]*m[2]+l[3]*m[3]){g=!1;break}}if(g){d=!1;break a}}d= !0}d=!d}if(d)return 0;d=c.qa(a.c,a.rc);e=a.D[0]/2;f=0;g=q.ba;h=q.ba-1;for(l=0;1>=l;l++)for(m=0;1>=m;m++){var n=[];ha(d,[m,l,c.L[l*h*g+m*h]],n);var p=a.i;p.v&&p.update();ha(p.U,n,p.Rb);var n=p.Rb,s=n[0],v=n[1],n=n[2],n=Math.sqrt(s*s+v*v+n*n),p=(n<p.eb?Number.POSITIVE_INFINITY:p.La[0]/n)*c.Ka[l][m]*e;p>f&&(f=p)}d=f;if(!c.Z||d<q.vc*a.kc){e=a.X.get(b);if(!(f=e)){a:if(c.Z){for(f=0;4>f;f++)if(c.Z&1<<f&&!a.X.contains(D(b,f))){f=!1;break a}f=!0}else f=!1;f=!f}f?Oa(a,b,e,c):Qa(a,b,c);return d}if(d=2.2>d)a:{if(a.X.contains(b)&& 1E4>c.Ka[0][0])for(d=0;4>d;d++)if(c.Z&1<<d&&(e=D(b,d),!a.X.get(e))){a.M.get(e);d=!0;break a}d=!1}return d?(e=a.X.get(b),Oa(a,b,e,c),0):Qa(a,b,c)} function Qa(a,b,c){var d=a.tc,e;e=c.f;var f=a.uc;null!=f?(f[0]=0.5*(e.e[0]+e.g[0]),f[1]=0.5*(e.e[1]+e.g[1]),e=f):e=u([0.5*(e.e[0]+e.g[0]),0.5*(e.e[1]+e.g[1]),0.5*(e.e[2]+e.g[2])]);f=a.i.c;e=Math.floor((Math.atan2(a.c[1]+f[1]-e[1],a.c[0]+f[0]-e[0])+Math.PI)/Math.PI*4);e=q.ca(e,0,7);for(var g=f=0;4>g;g++){var h=d[e][g];c.Z&1<<h&&(f=Math.max(f,Pa(a,D(b,h))))}return f} function K(a){switch(a.a.l.la){case "observer":a.h[1]=q.ca(a.h[1],-90,10);a.c[2]=q.ca(a.c[2],5,a.i.pa);y(q.xa(2,q.oa(a.h[0])),q.xa(0,q.oa(a.h[1])),a.Wb);var b=u([0,-a.c[2],0]);ha(a.Wb,b);b[2]+=q.Da(a.a,a.c,a.M)[0];a.i.za(b);a.i.ya(a.h);break;case "drone":a.h[1]=q.ca(a.h[1],-90,90);a.c[2]=q.ca(a.c[2],5,a.i.pa);b=a.i.c;a.i.za(u([0,0,a.c[2]+q.Da(a.a,[a.c[0]+b[0],a.c[1]+b[1]],a.M)[0]]));a.i.ya(a.h);break;case "manual":a.i.za(u([0,0,a.c[2]])),a.i.ya(a.h)}a.v=!0} function Ma(a){if("drone"==a.a.l.la&&!a.Bb){var b=q.Da(a.a,a.c,a.M);if(!b[1])return;a.c[2]+=b[0];a.Bb=!0}a.q.clear();K(a);Pa(a,a.a.s.G);b=w();y(q.Pa(2,2,2),q.ja(-0.5,-0.5,-0.5),b);var c=w();y(q.ja(a.i.ma()[0],a.i.ma()[1],a.i.ma()[2]-400),q.wc(0.9*a.i.pa),c);var d=w(),e=a.i;e.v&&e.update();y(e.Ia,c,d);y(d,b,d);a.q.useProgram(a.wa,"aPosition","aTexCoord");a.q.bindTexture(a.ia);ya(a.wa);H(a.wa,"uMVP",d);za(a.Aa,a.wa);a.$+=a.Aa.hb;a.M.trim(a.a.l.Va/10);a.X.trim(a.a.l.Va);a.ib=!1} Ia.prototype.update=function(){if(!0!=this.k){if(null==this.F||"hidden"!=this.F.style.visibility){this.D[0]==this.F.clientWidth&&this.D[1]==this.F.clientHeight||this.Lb();null!=this.Mb&&this.Mb();this.M.update();this.X.update();if(!0==this.Xb&&(this.$=this.Na=this.Oa=0,this.Ca++,10<=this.Ca)){var a=Date.now();null!=this.bb&&(this.Ya=0.5*(1E3/(a-this.bb)*this.Ca+this.Ya));this.bb=a}a=performance.now();!0==this.v&&Ma(this);!0==this.Xb&&(this.Sa++,this.Ma+=performance.now()-a,100<=this.Sa&&(this.Pb= this.Ma/this.Sa,this.Sa=this.Ma=0),null!=this.Sb&&10<=this.Ca&&(this.Ca=0,!0==this.v&&(this.Sb.innerHTML="Redered tiles: "+(this.Oa+this.Na)+"<br/>Terrain tiles: "+this.Oa+"<br/>Heightmap tiles: "+this.Na+"<br/>Tile cache: "+Math.round(this.X.size()/1048576)+"MB<br/>Metatile cache: "+Math.round(this.M.size()/1048576)+"MB<br/>GPU cache: "+Math.round(this.$a.size()/1048576)+"MB<br/>Polygons: "+this.$+"<br/>Render time: "+Math.round(1E3*this.Pb)+"<br/>FPS: "+Math.round(this.Ya))));this.v=!1}window.Qb(this.update.bind(this))}}; function Ra(a,b,c,d){this.a=a;this.w=b;this.H=c;this.C=d;this.O=this.H.size()+d.naturalWidth*d.naturalHeight*3}Ra.prototype.t=function(){null!=this.H&&(this.H.t(),this.H=null);this.C=null}; Ra.prototype.qa=function(a,b){var c=A(this.a.s,this.w.j),d=c/2+this.w.n-a[0],c=c/2+this.w.o-a[1],e=this.H.f,f=b;null!=f?(f[0]=B(e,0),f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=B(e,1),f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=B(e,2),f[11]=0,f[12]=e.e[0]+d,f[13]=e.e[1]+c,f[14]=e.e[2],f[15]=1):(f=w(),y(q.ja(e.e[0]+d,e.e[1]+c,e.e[2]),q.Pa(B(e,0),B(e,1),B(e,2)),f));return f};Ra.prototype.size=function(){return this.O};q.Zb=ta; q.$b=function(a,b,c,d){this.a=a;this.w=b;this.va=c;this.ua=d;this.Xa=this.Cb=this.Fb=!1;this.Ea=function(){!0==this.Xa?null!=this.ua&&this.ua():!0==this.Fb&&!0==this.Cb&&null!=this.va&&this.va(this.w,new Ra(this.a,this.w,this.H,this.C))}.bind(this);this.C=new Image;this.C.onload=function(){!0!=this.a.k&&(this.Cb=!0,this.Ea())}.bind(this);this.C.onerror=function(){!0!=this.a.k&&(this.Xa=!0,this.Ea())}.bind(this);this.C.crossOrigin="anonymous";this.C.src=ma(this.a.s,this.w);this.H=new J;this.oc=function(){!0!= this.a.k&&(this.Fb=!0,this.Ea())}.bind(this);this.nc=function(){!0!=this.a.k&&(this.Xa=!0,this.Ea())}.bind(this);this.H.load(la(this.a.s,this.w),this.oc,this.nc)};function z(a,b,c,d){this.a=a;this.j=null!=b?b:0;this.n=null!=c?c:0;this.o=null!=d?d:0}function D(a,b){var c=A(a.a.s,a.j),d=a.n+c/2,c=a.o+c/2;switch(b){case 0:return new z(a.a,a.j+1,a.n,a.o);case 1:return new z(a.a,a.j+1,d,a.o);case 2:return new z(a.a,a.j+1,a.n,c);case 3:return new z(a.a,a.j+1,d,c)}} z.prototype.parent=function(){var a=A(this.a.s,this.j),b=this.a.s.G;return new z(this.a,this.j-1,b.n+((this.n-b.n)/a&-2)*a,b.o+((this.o-b.o)/a&-2)*a)};z.prototype.isEqual=function(a){return this.j==a.j&&this.n==a.n&&this.o==a.o}; function L(a,b,c,d,e){if(null!=b&&""!=b){this.K=[];this.A=[];this.Q=[];this.kb=this.l=this.s=this.b=null;this.k=!1;this.F=null;var f="";"string"===typeof b&&(f=b.split("?")[0].split("/").slice(0,-1).join("/")+"/");"string"===typeof a?this.F=document.getElementById(a):"object"===typeof a&&(this.F=a);if(null==this.F)null!=d&&d(!1,"DOM element does not exist");else{var g=null,h=null,l=function(){null==g||null==h&&null!=c||(this.s=new ia(this,g,f),this.l=new oa(h),this.kb=e,this.b=new Ia(this,this.F, this.pc.bind(this)),null!=d&&d(!0))}.bind(this);a=function(a){g=a;l()}.bind(this);var m=function(a){h=a;l()}.bind(this),n=function(a){null!=d&&d(!1,a+" config not found")}.bind(this);null!=c&&"string"===typeof c&&q.Eb(c,m,n.bind(this,"browser"));"string"===typeof b&&q.Eb(b,a,n.bind(this,"map"));"object"===typeof b&&(g=b);"object"===typeof c&&(h=c);null==g&&null==h||l()}}}k=L.prototype;k.t=function(){this.b.t();this.k=!0}; k.Qa=function(a){if(!0!=this.k&&null!=this.b&&null!=this.b.i&&this.l.la!=a){if("manual"==a){var b;b=!0!=q.k&&null!=q.b?q.Da(q.a,r([this.b.c[0],this.b.c[1]]),q.b.M):void 0;b[0]>this.b.c[2]&&(this.b.c[2]=b[0]+100)}this.l.la=a;K(this.b);this.K=[];this.Q=[];this.A=[]}};k.xb=function(){return this.l.la};k.za=function(a,b,c){!0!=this.k&&null!=this.b&&(this.b.c=[a,b,c],K(this.b))};k.ma=function(){return!0==this.k||null==this.b?[0,0,0]:[this.b.c[0],this.b.c[1],this.b.c[2]]}; k.ya=function(a,b,c){!0!=this.k&&null!=this.b&&(this.b.h=[a,b,c],K(this.b))};k.Za=function(){return!0==this.k||null==this.b?[0,0,0]:this.b.h};k.xc=function(a,b){if(null!=this.b&&null!=this.b.i){var c=this.b.i;c.wb=a;c.eb=20;c.pa=b;c.v=!0;K(this.b)}};k.jc=function(){return[0,0,0]};k.sc=function(){return[0,0,0]};k.Dc=function(){return[[0,0],[1,0],[0,1]]}; k.Ob=function(a,b){if(!0!=this.k&&null!=this.b){var c=this.b,d=c.i.c,c=(c.i.ma()[2]-q.Da(c.a,[c.c[0]+d[0],c.c[1]+d[1]],c.M)[0])/800;a*=c;b*=c;d=q.oa(this.Za()[0]);c=[-Math.sin(d),Math.cos(d)];d=[Math.cos(d),Math.sin(d)];this.b.c[0]+=c[0]*b-d[0]*a;this.b.c[1]+=c[1]*b-d[1]*a;0<this.l.da[0]&&this.K.push([c[0]*b-d[0]*a,c[1]*b-d[1]*a]);K(this.b)}}; k.rotate=function(a,b,c){!0!=this.k&&null!=this.b&&(null==c&&(c=0),this.b.h[0]+=0.3*-a,this.b.h[1]+=0.3*-b,this.b.h[2]+=0.3*c,0<this.l.da[1]&&this.A.push([0.3*-a,0.3*-b,0.3*c]),this.b.ib=!0,K(this.b))};k.zoom=function(a){!0!=this.k&&null!=this.b&&(a=1+0.001*a,this.b.c[2]*=a,0<this.l.da[2]&&this.Q.push([a]),K(this.b))}; k.pc=function(){if(!0!=this.k&&null!=this.b){var a=!1,b=this.l.da[0],c=this.l.da[1],d=this.l.da[2];0<this.A.length&&0==this.K.length&&0==this.Q.length&&(this.b.ib=!0);for(var e=0;e<this.K.length;e++)this.K[e][0]*=b,this.K[e][1]*=b,this.b.c[0]+=this.K[e][0],this.b.c[1]+=this.K[e][1],0.01>Math.abs(this.K[e][0])+Math.abs(this.K[e][1])&&(this.K.splice(e,1),e--),a=!0;for(e=0;e<this.Q.length;e++)this.Q[e][0]+=(1-this.Q[e][0])*(1-d),this.b.c[2]*=this.Q[e][0],this.b.c[2]=Math.min(this.b.c[2],4E5),0.001>Math.abs(1- this.Q[e][0])&&(this.Q.splice(e,1),e--),a=!0;for(e=0;e<this.A.length;e++)this.A[e][0]*=c,this.A[e][1]*=c,this.A[e][2]*=c,this.b.h[0]+=this.A[e][0],this.b.h[1]+=this.A[e][1],this.b.h[2]+=this.A[e][2],0.01>Math.abs(this.A[e][0])+Math.abs(this.A[e][1])+Math.abs(this.A[e][2])&&(this.A.splice(e,1),e--),a=!0;!0==a&&K(this.b);null!=this.kb&&this.kb()}}; q.pb=function(){var a=document.createElement("canvas");if(null==a)return!1;a.width=1024;a.height=768;if(null==a.getContext)return!1;var b=null;try{b=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(c){return!1}return b?!0:!1};q.Browser=L;L.prototype.setControlMode=L.prototype.Qa;L.prototype.getControlMode=L.prototype.xb;L.prototype.setPosition=L.prototype.za;L.prototype.getPosition=L.prototype.ma;L.prototype.setOrientation=L.prototype.ya;L.prototype.getOrientation=L.prototype.Za; L.prototype.setCamera=L.prototype.xc;L.prototype.hitTest=L.prototype.jc;L.prototype.project=L.prototype.sc;L.prototype.visibleArea=L.prototype.Dc;L.prototype.pan=L.prototype.Ob;L.prototype.rotate=L.prototype.rotate;L.prototype.zoom=L.prototype.zoom;L.prototype.kill=L.prototype.t;q.checkSupport=q.pb;var M=null;function Sa(a,b){!1==a&&alert("Vadstena3D initialization failed. Reason: "+b)}var N=!1,O=!1,P=!1,Ta=!1,Ua=!1,Va=0,Wa=0,Xa=0,Ya=0; function Za(a){var b=!1;a=a||window.event;a.which?b=3==a.which:a.button&&(b=2==a.button);!0==b?Ta=!0:Ua=!0;N=a.altKey;O=a.ctrlKey;P=a.shiftKey}function $a(a){var b=!1;a=a||window.event;a.which?b=3==a.which:a.button&&(b=2==a.button);!0==b?Ta=!1:Ua=!1}function ab(a){var b=a.clientX;a=a.clientY;Xa=b-Va;Ya=a-Wa;Va=b;Wa=a;!0==Ua&&!0!=N&&!0!=O&&!0!=P&&M.Ob(0.5*Xa,0.5*Ya);!0!=Ta&&(!0!=Ua||!0!=N&&!0!=O&&!0!=P)||M.rotate(0.4*Xa,0.4*Ya)} function bb(a){a.preventDefault&&a.preventDefault();a.returnValue=!1;var b=0,b=a.wheelDelta,b=(a=a.detail)?b?b/a/40*(0<=a?1:-1):-a/3:b/120;!0==isNaN(b)&&(b=0);b=0>b?1:-1;"observer"==M.xb()?M.zoom(17.5*b):M.zoom(7*b)}function cb(a){"undefined"==typeof a&&(a=window.event);N=a.altKey;O=a.ctrlKey;P=a.shiftKey} function db(a){"undefined"==typeof a&&(a=window.event);if(a)switch(window.event?window.event.keyCode:a.which?a.which:a.charCode){case 49:M.Qa("manual");break;case 50:M.Qa("drone");break;case 51:M.Qa("observer")}N=a.altKey;O=a.ctrlKey;P=a.shiftKey} window.startDemo=function(){!1==q.pb()?alert("Unfturtunately, Vadstena3D needs browser support for WebGL. Sorry."):(M=new L("demo","./mapConfig.json",null,Sa),document.onmousedown=Za,document.oncontextmenu=function(){return!1},document.onmouseup=$a,document.onmousemove=ab,window.addEventListener("DOMMouseScroll",bb,!0),window.addEventListener("mousewheel",bb,!0),document.onselectstart=function(){return!1},document.onkeyup=db,document.onkeydown=cb)};</script>
</head>
<body style = "padding: 0; margin: 0;" onload="startDemo()">
<div id="demo" style="width:100%; height:100%;"></div>
<div style="position:absolute;left:0px;bottom:0px; width:100%; height: 50px; background-color: rgba(0,0,0,0.85);">
<img style="padding-left:10px;padding-top:10px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMUAAAAeCAYAAACcwdocAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1NThDQTU2QTA2OTRFMzExQkVBNUJERDYzRjYwNzdDNiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCMEY0NzI2RTk0MDcxMUUzOEIyOEZBRjZCNkZDRTBFNyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCMEY0NzI2RDk0MDcxMUUzOEIyOEZBRjZCNkZDRTBFNyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjU2OENBNTZBMDY5NEUzMTFCRUE1QkRENjNGNjA3N0M2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU1OENBNTZBMDY5NEUzMTFCRUE1QkRENjNGNjA3N0M2Ii8+IDwvcmRmOkRlc2NyaXB0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">
</div>
</body>
</html>